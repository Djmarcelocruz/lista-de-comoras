<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<meta name="theme-color" content="#0b76d1"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="apple-mobile-web-app-title" content="DJ Pro"/>
<meta name="description" content="Sistema profissional de gestÃ£o para DJs"/>
<title>DJ Pro - Sistema de GestÃ£o</title>

<link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%230b76d1' width='100' height='100' rx='20'/%3E%3Ctext x='50' y='65' font-size='50' text-anchor='middle'%3EğŸ§%3C/text%3E%3C/svg%3E"/>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%230b76d1' width='100' height='100' rx='20'/%3E%3Ctext x='50' y='65' font-size='50' text-anchor='middle'%3EğŸ§%3C/text%3E%3C/svg%3E"/>

<style>
  :root {
    --primary: #0b76d1;
    --primary-dark: #0056b3;
    --secondary: #6c757d;
    --success: #28a745;
    --danger: #dc3545;
    --warning: #ffc107;
    --info: #17a2b8;
    --bg: #f8f9fa;
    --card: #ffffff;
    --text: #212529;
    --text-muted: #6c757d;
    --border: #dee2e6;
    --shadow: 0 4px 20px rgba(0,0,0,0.08);
    --radius: 16px;
    --header-height: 70px;
    --bottom-nav-height: 70px;
  }

  [data-theme="dark"] {
    --bg: #0f1419;
    --card: #1a1d29;
    --text: #e4e6eb;
    --text-muted: #b0b3b8;
    --border: #3e4042;
    --shadow: 0 4px 20px rgba(0,0,0,0.4);
  }

  [data-color="purple"] { --primary: #6f42c1; --primary-dark: #5a32a3; }
  [data-color="green"] { --primary: #28a745; --primary-dark: #1e7e34; }
  [data-color="red"] { --primary: #dc3545; --primary-dark: #bd2130; }
  [data-color="orange"] { --primary: #fd7e14; --primary-dark: #e56b0a; }
  [data-color="pink"] { --primary: #e83e8c; --primary-dark: #d91a72; }
  [data-color="black"] { --primary: #343a40; --primary-dark: #1d2124; }

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  html { scroll-behavior: smooth; }
  
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    padding-bottom: calc(var(--bottom-nav-height) + 20px);
    min-height: 100vh;
  }

  .app-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: var(--header-height);
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    z-index: 1000;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  }
  
  .app-header h1 {
    font-size: 22px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .header-actions {
    display: flex;
    gap: 10px;
  }
  
  .header-btn {
    width: 44px;
    height: 44px;
    border-radius: 12px;
    border: none;
    background: rgba(255,255,255,0.2);
    color: white;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    backdrop-filter: blur(10px);
  }
  
  .header-btn:hover { background: rgba(255,255,255,0.3); transform: scale(1.05); }

  .main-content {
    margin-top: var(--header-height);
    padding: 20px;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }

  .card {
    background: var(--card);
    border-radius: var(--radius);
    padding: 24px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
    animation: slideUp 0.4s ease;
  }
  
  @keyframes slideUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .card-title {
    font-size: 20px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .form-group {
    margin-bottom: 20px;
  }
  
  .form-label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: var(--text-muted);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .form-control {
    width: 100%;
    padding: 14px 18px;
    border: 2px solid var(--border);
    border-radius: 12px;
    background: var(--card);
    color: var(--text);
    font-size: 16px;
    transition: all 0.2s;
  }
  
  .form-control:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(11, 118, 209, 0.1);
    outline: none;
  }

  .form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 14px 24px;
    border-radius: 12px;
    border: none;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    background: var(--primary);
    color: white;
    text-decoration: none;
  }
  
  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(11, 118, 209, 0.3);
  }
  
  .btn-success { background: var(--success); }
  .btn-danger { background: var(--danger); }
  .btn-warning { background: var(--warning); color: #000; }
  .btn-secondary { background: var(--secondary); }
  .btn-outline {
    background: transparent;
    border: 2px solid var(--primary);
    color: var(--primary);
  }
  .btn-outline:hover { background: var(--primary); color: white; }
  .btn-lg { padding: 18px 32px; font-size: 17px; width: 100%; }
  .btn-sm { padding: 10px 16px; font-size: 13px; }

  .bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: var(--bottom-nav-height);
    background: var(--card);
    border-top: 1px solid var(--border);
    display: flex;
    justify-content: space-around;
    align-items: center;
    z-index: 999;
    padding-bottom: env(safe-area-inset-bottom);
  }
  
  .nav-item {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
    padding: 10px;
    color: var(--text-muted);
    text-decoration: none;
    font-size: 12px;
    font-weight: 500;
    transition: all 0.2s;
    cursor: pointer;
    background: none;
    border: none;
  }
  
  .nav-item .icon { font-size: 24px; transition: transform 0.2s; }
  .nav-item.active { color: var(--primary); }
  .nav-item.active .icon { transform: translateY(-4px); }

  .section { display: none; animation: fadeIn 0.3s ease; }
  .section.active { display: block; }
  
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-bottom: 20px;
  }
  
  .stat-card {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 20px;
    border-radius: var(--radius);
    text-align: center;
  }
  
  .stat-value { font-size: 28px; font-weight: 800; margin-bottom: 5px; }
  .stat-label { font-size: 12px; opacity: 0.9; text-transform: uppercase; letter-spacing: 1px; }

  .list-item {
    background: var(--bg);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 12px;
    border-left: 4px solid var(--primary);
    transition: all 0.2s;
  }
  
  .list-item:hover { transform: translateX(5px); box-shadow: var(--shadow); }
  
  .list-item-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 10px;
  }
  
  .list-item-title { font-size: 17px; font-weight: 700; color: var(--text); }
  .list-item-meta { font-size: 14px; color: var(--text-muted); margin-top: 5px; }
  .list-item-actions { display: flex; gap: 8px; margin-top: 15px; flex-wrap: wrap; }

  .badge {
    display: inline-flex;
    align-items: center;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
  }
  
  .badge-success { background: #d4edda; color: #155724; }
  .badge-warning { background: #fff3cd; color: #856404; }
  .badge-danger { background: #f8d7da; color: #721c24; }
  .badge-info { background: #d1ecf1; color: #0c5460; }

  /* ÃREA DO CONTRATO - Apenas esta parte aparece na impressÃ£o */
  #contractPrintArea {
    background: white;
    color: black;
    padding: 40px;
    font-family: 'Times New Roman', Times, serif;
    line-height: 1.8;
    font-size: 14px;
    max-width: 800px;
    margin: 0 auto;
  }

  #contractPrintArea h2 {
    color: black;
    text-align: center;
    margin-bottom: 30px;
    font-size: 22px;
    font-weight: bold;
    text-transform: uppercase;
  }

  #contractPrintArea p {
    margin-bottom: 15px;
    text-align: justify;
    color: black;
  }

  #contractPrintArea strong {
    color: black;
  }

  #contractPrintArea .signature-area {
    margin-top: 60px;
    display: flex;
    justify-content: space-between;
    gap: 40px;
  }

  #contractPrintArea .signature-box {
    text-align: center;
    flex: 1;
  }

  #contractPrintArea .signature-line {
    border-top: 1px solid #333;
    height: 80px;
    margin-bottom: 10px;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-bottom: 5px;
  }

  /* Controles do contrato - NÃƒO aparecem na impressÃ£o */
  .contract-controls {
    background: var(--card);
    border-radius: var(--radius);
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
  }

  .signature-pad-container {
    background: var(--card);
    border-radius: var(--radius);
    padding: 20px;
    margin-top: 20px;
    box-shadow: var(--shadow);
  }

  .signature-pad {
    background: white;
    border: 2px solid #333;
    border-radius: 8px;
    width: 100%;
    height: 250px;
    touch-action: none;
    cursor: crosshair;
    display: block;
  }

  /* CSS CRÃTICO PARA IMPRESSÃƒO - Esconde TUDO exceto o contrato */
  @media print {
    * {
      visibility: hidden !important;
    }
    
    html, body {
      background: white !important;
      padding: 0 !important;
      margin: 0 !important;
    }
    
    #contractPrintArea,
    #contractPrintArea * {
      visibility: visible !important;
      color: black !important;
      background: white !important;
      box-shadow: none !important;
      border: none !important;
    }
    
    #contractPrintArea {
      position: absolute !important;
      left: 0 !important;
      top: 0 !important;
      width: 100% !important;
      max-width: 100% !important;
      padding: 20px !important;
      margin: 0 !important;
      display: block !important;
    }
    
    #contractPrintArea h2 {
      font-size: 18px !important;
      margin-bottom: 20px !important;
    }
    
    #contractPrintArea p {
      font-size: 12px !important;
      line-height: 1.6 !important;
      margin-bottom: 10px !important;
    }
    
    #contractPrintArea .signature-area {
      margin-top: 40px !important;
    }
    
    .app-header, 
    .bottom-nav, 
    .contract-controls,
    .signature-pad-container,
    .btn,
    .card:not(#contractPrintArea),
    .section:not(#contrato),
    #contrato > *:not(#contractPrintArea) {
      display: none !important;
      visibility: hidden !important;
    }
  }

  .modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.6);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    padding: 20px;
    backdrop-filter: blur(5px);
  }
  
  .modal-overlay.active { display: flex; }
  
  .modal-content {
    background: var(--card);
    border-radius: var(--radius);
    width: 100%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    animation: modalSlide 0.3s ease;
  }
  
  @keyframes modalSlide {
    from { transform: translateY(50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  
  .modal-header {
    padding: 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .modal-header h3 { font-size: 20px; font-weight: 700; color: var(--primary); }
  
  .modal-close {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: none;
    background: var(--bg);
    color: var(--text);
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .modal-body { padding: 24px; }
  .modal-footer {
    padding: 20px 24px;
    border-top: 1px solid var(--border);
    display: flex;
    gap: 10px;
    justify-content: flex-end;
  }

  .login-screen {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    z-index: 3000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px;
  }
  
  .login-logo { font-size: 80px; margin-bottom: 20px; }
  .login-title { color: white; font-size: 28px; font-weight: 700; margin-bottom: 10px; }
  .login-subtitle { color: rgba(255,255,255,0.8); margin-bottom: 40px; text-align: center; }
  
  .pin-display { display: flex; gap: 15px; margin-bottom: 30px; }
  
  .pin-dot {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255,255,255,0.3);
    transition: all 0.2s;
  }
  
  .pin-dot.filled { background: white; transform: scale(1.2); }
  
  .pin-pad {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    width: 100%;
    max-width: 300px;
  }
  
  .pin-btn {
    aspect-ratio: 1;
    border-radius: 50%;
    border: 2px solid rgba(255,255,255,0.3);
    background: transparent;
    color: white;
    font-size: 24px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .pin-btn:hover { background: rgba(255,255,255,0.1); border-color: white; }

  .profile-header {
    text-align: center;
    padding: 30px;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    border-radius: var(--radius);
    margin-bottom: 20px;
  }
  
  .profile-avatar {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 50px;
    margin: 0 auto 15px;
    border: 4px solid rgba(255,255,255,0.3);
  }
  
  .profile-name { font-size: 24px; font-weight: 700; margin-bottom: 5px; }
  .profile-role { opacity: 0.9; font-size: 14px; }

  .color-picker { display: flex; gap: 10px; flex-wrap: wrap; }
  
  .color-option {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    cursor: pointer;
    border: 3px solid transparent;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
  }
  
  .color-option:hover { transform: scale(1.1); }
  .color-option.selected { border-color: var(--text); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }

  .toast {
    position: fixed;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--success);
    color: white;
    padding: 16px 32px;
    border-radius: 50px;
    font-weight: 600;
    z-index: 4000;
    opacity: 0;
    transition: all 0.3s;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  }
  
  .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
  .toast.error { background: var(--danger); }
  .toast.warning { background: var(--warning); color: #000; }

  .empty-state { text-align: center; padding: 60px 20px; color: var(--text-muted); }
  .empty-state-icon { font-size: 64px; margin-bottom: 20px; opacity: 0.5; }

  .section-group {
    background: var(--bg);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    border: 1px solid var(--border);
  }

  .section-group-title {
    font-size: 16px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .progress-bar {
    width: 100%;
    height: 20px;
    background: var(--border);
    border-radius: 10px;
    overflow: hidden;
    margin-top: 10px;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--success), var(--primary));
    transition: width 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 12px;
    font-weight: 600;
  }

  @media (min-width: 1024px) {
    .main-content { max-width: 1000px; }
    .bottom-nav { display: none; }
    body { padding-bottom: 20px; }
  }

  @media (max-width: 480px) {
    :root { --radius: 12px; }
    .card { padding: 20px; }
    .stat-value { font-size: 24px; }
    .btn { padding: 12px 20px; }
    .form-row { grid-template-columns: 1fr; }
    #contractPrintArea { padding: 20px; }
  }

  @supports (padding-top: env(safe-area-inset-top)) {
    .app-header {
      padding-top: env(safe-area-inset-top);
      height: calc(var(--header-height) + env(safe-area-inset-top));
    }
    .main-content { margin-top: calc(var(--header-height) + env(safe-area-inset-top)); }
  }
</style>
</head>
<body>

<!-- TELA DE LOGIN/PIN -->
<div id="loginScreen" class="login-screen" style="display: none;">
  <div class="login-logo">ğŸ§</div>
  <div class="login-title" id="loginTitle">DJ Pro</div>
  <div class="login-subtitle" id="loginSubtitle">Digite seu PIN para acessar</div>
  
  <div class="pin-display" id="pinDisplay">
    <div class="pin-dot"></div>
    <div class="pin-dot"></div>
    <div class="pin-dot"></div>
    <div class="pin-dot"></div>
  </div>
  
  <div class="pin-pad">
    <button class="pin-btn" onclick="enterPin(1)">1</button>
    <button class="pin-btn" onclick="enterPin(2)">2</button>
    <button class="pin-btn" onclick="enterPin(3)">3</button>
    <button class="pin-btn" onclick="enterPin(4)">4</button>
    <button class="pin-btn" onclick="enterPin(5)">5</button>
    <button class="pin-btn" onclick="enterPin(6)">6</button>
    <button class="pin-btn" onclick="enterPin(7)">7</button>
    <button class="pin-btn" onclick="enterPin(8)">8</button>
    <button class="pin-btn" onclick="enterPin(9)">9</button>
    <button class="pin-btn" onclick="clearPin()">âŒ«</button>
    <button class="pin-btn" onclick="enterPin(0)">0</button>
    <button class="pin-btn" onclick="skipLogin()">âœ“</button>
  </div>
</div>

<!-- HEADER -->
<header class="app-header">
  <h1>ğŸ§ <span id="appTitle">DJ Pro</span></h1>
  <div class="header-actions">
    <button class="header-btn" onclick="showModal('config')" title="ConfiguraÃ§Ãµes">âš™ï¸</button>
    <button class="header-btn" onclick="toggleTheme()" title="Tema">ğŸŒ“</button>
  </div>
</header>

<!-- CONTEÃšDO PRINCIPAL -->
<main class="main-content">

<!-- DASHBOARD -->
<section id="dashboard" class="section active">
  <div class="stats-grid">
    <div class="stat-card" onclick="showTab('caixa')" style="cursor: pointer;">
      <div class="stat-value" id="dashTotal">R$ 0</div>
      <div class="stat-label">ğŸ’° Caixa</div>
    </div>
    <div class="stat-card" style="background: linear-gradient(135deg, var(--info) 0%, #0dcaf0 100%);">
      <div class="stat-value" id="dashEventos">0</div>
      <div class="stat-label">Eventos</div>
    </div>
    <div class="stat-card" style="background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);">
      <div class="stat-value" id="dashRecibos">0</div>
      <div class="stat-label">Recibos</div>
    </div>
    <div class="stat-card" style="background: linear-gradient(135deg, var(--warning) 0%, #ff6b6b 100%);">
      <div class="stat-value" id="dashPendentes">0</div>
      <div class="stat-label">Pendentes</div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">ğŸ“… PrÃ³ximos Eventos</div>
    <div id="listaProximos">
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ“­</div>
        <p>Nenhum evento prÃ³ximo</p>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">âš¡ AÃ§Ãµes RÃ¡pidas</div>
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
      <button class="btn btn-success" onclick="showTab('cadastro')">
        â• Novo Evento
      </button>
      <button class="btn btn-primary" onclick="showTab('caixa')">
        ğŸ’° Caixa/Financeiro
      </button>
    </div>
  </div>
</section>

<!-- CADASTRO DE EVENTO -->
<section id="cadastro" class="section">
  <div class="card">
    <div class="card-title">ğŸ“ Novo Evento</div>
    
    <input type="hidden" id="editId">
    
    <!-- DADOS DO CLIENTE -->
    <div class="section-group">
      <div class="section-group-title">ğŸ‘¤ Dados do Cliente (Contratante)</div>
      
      <div class="form-group">
        <label class="form-label">Nome Completo *</label>
        <input type="text" id="cli_nome" class="form-control" placeholder="Nome completo do cliente" required>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">CPF/CNPJ</label>
          <input type="text" id="cli_cpf" class="form-control" placeholder="000.000.000-00">
        </div>
        <div class="form-group">
          <label class="form-label">RG</label>
          <input type="text" id="cli_rg" class="form-control" placeholder="00.000.000-0">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Telefone *</label>
          <input type="tel" id="cli_tel" class="form-control" placeholder="(00) 00000-0000" required>
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" id="cli_email" class="form-control" placeholder="email@exemplo.com">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">EndereÃ§o Completo</label>
        <input type="text" id="cli_endereco" class="form-control" placeholder="Rua, nÃºmero, bairro, cidade, estado, CEP">
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">ProfissÃ£o</label>
          <input type="text" id="cli_profissao" class="form-control" placeholder="ProfissÃ£o do cliente">
        </div>
        <div class="form-group">
          <label class="form-label">Estado Civil</label>
          <select id="cli_estado_civil" class="form-control">
            <option value="">Selecione...</option>
            <option value="Solteiro(a)">Solteiro(a)</option>
            <option value="Casado(a)">Casado(a)</option>
            <option value="Divorciado(a)">Divorciado(a)</option>
            <option value="ViÃºvo(a)">ViÃºvo(a)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- DADOS DO EVENTO -->
    <div class="section-group">
      <div class="section-group-title">ğŸ‰ Dados do Evento</div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Data do Evento *</label>
          <input type="date" id="evt_data" class="form-control" required>
        </div>
        <div class="form-group">
          <label class="form-label">HorÃ¡rio de InÃ­cio *</label>
          <input type="time" id="evt_hora_inicio" class="form-control" required>
        </div>
        <div class="form-group">
          <label class="form-label">HorÃ¡rio de TÃ©rmino</label>
          <input type="time" id="evt_hora_fim" class="form-control">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Local do Evento *</label>
        <input type="text" id="evt_local" class="form-control" placeholder="Nome do local (salÃ£o, igreja, etc)" required>
      </div>

      <div class="form-group">
        <label class="form-label">EndereÃ§o do Local</label>
        <input type="text" id="evt_local_endereco" class="form-control" placeholder="EndereÃ§o completo onde serÃ¡ realizado o evento">
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Tipo de Evento *</label>
          <select id="evt_tipo" class="form-control" required>
            <option value="">Selecione...</option>
            <option value="Casamento">ğŸ’’ Casamento</option>
            <option value="AniversÃ¡rio">ğŸ‚ AniversÃ¡rio</option>
            <option value="Formatura">ğŸ“ Formatura</option>
            <option value="Corporativo">ğŸ’¼ Corporativo</option>
            <option value="Debutante">ğŸ‘¸ Debutante (15 anos)</option>
            <option value="Infantil">ğŸ§’ Festa Infantil</option>
            <option value="ChÃ¡ de BebÃª">ğŸ¼ ChÃ¡ de BebÃª</option>
            <option value="ChÃ¡ de Panela">ğŸ³ ChÃ¡ de Panela</option>
            <option value="Noivado">ğŸ’ Noivado</option>
            <option value="Bodas">ğŸ’ Bodas</option>
            <option value="RÃ©veillon">ğŸ† RÃ©veillon</option>
            <option value="Carnaval">ğŸ­ Carnaval</option>
            <option value="Outro">ğŸ“Œ Outro</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Quantidade de Convidados</label>
          <input type="number" id="evt_convidados" class="form-control" placeholder="NÃºmero estimado" min="1">
        </div>
      </div>
    </div>

    <!-- VALORES E PAGAMENTO -->
    <div class="section-group">
      <div class="section-group-title">ğŸ’° Valores e Pagamento</div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Valor Total (R$) *</label>
          <input type="number" id="evt_valor" class="form-control" placeholder="0,00" step="0.01" required>
        </div>
        <div class="form-group">
          <label class="form-label">Sinal/Entrada (R$)</label>
          <input type="number" id="evt_sinal" class="form-control" placeholder="0,00" step="0.01">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Forma de Pagamento</label>
          <select id="evt_forma_pgto" class="form-control">
            <option value="Pix">âš¡ Pix</option>
            <option value="Dinheiro">ğŸ’µ Dinheiro</option>
            <option value="CartÃ£o de CrÃ©dito">ğŸ’³ CartÃ£o de CrÃ©dito</option>
            <option value="CartÃ£o de DÃ©bito">ğŸ’³ CartÃ£o de DÃ©bito</option>
            <option value="TransferÃªncia">ğŸ¦ TransferÃªncia</option>
            <option value="Boleto">ğŸ“„ Boleto</option>
            <option value="Cheque">ğŸ“ Cheque</option>
            <option value="Misto">ğŸ’° Misto (combinar)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Data de Vencimento</label>
          <input type="date" id="evt_vencimento" class="form-control">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Status do Pagamento</label>
        <select id="evt_status_pgto" class="form-control">
          <option value="pendente">â³ Pendente</option>
          <option value="sinal_pago">ğŸ’µ Sinal Pago</option>
          <option value="pago">âœ… Totalmente Pago</option>
          <option value="atrasado">âš ï¸ Atrasado</option>
        </select>
      </div>
    </div>

    <!-- DETALHES DO SERVIÃ‡O -->
    <div class="section-group">
      <div class="section-group-title">ğŸ§ Detalhes do ServiÃ§o</div>
      
      <div class="form-group">
        <label class="form-label">Equipamentos Inclusos</label>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="equip_som" checked> Som/ caixas
          </label>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="equip_luz" checked> IluminaÃ§Ã£o
          </label>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="equip_microfone"> Microfones
          </label>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="equip_projetor"> Projetor/Telas
          </label>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="equip_fumaca"> MÃ¡quina de FumaÃ§a
          </label>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="equip_bolhas"> MÃ¡quina de Bolhas
          </label>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">ObservaÃ§Ãµes Especiais</label>
        <textarea id="evt_obs" class="form-control" rows="4" placeholder="Playlist especÃ­fica, mÃºsicas proibidas, cerimÃ´nias especiais, etc..."></textarea>
      </div>

      <div class="form-group">
        <label class="form-label">Status do Evento</label>
        <select id="evt_status" class="form-control">
          <option value="agendado">ğŸ“… Agendado</option>
          <option value="confirmado">âœ… Confirmado</option>
          <option value="em_andamento">ğŸµ Em Andamento</option>
          <option value="concluido">ğŸ‰ ConcluÃ­do</option>
          <option value="cancelado">âŒ Cancelado</option>
          <option value="adiado">â¸ï¸ Adiado</option>
        </select>
      </div>
    </div>

    <div style="display: flex; gap: 10px; margin-top: 20px;">
      <button class="btn btn-success btn-lg" onclick="salvarEvento()">
        ğŸ’¾ Salvar Evento
      </button>
      <button class="btn btn-secondary" onclick="limparFormulario()" type="button">
        ğŸ”„ Limpar
      </button>
    </div>
  </div>
</section>

<!-- CONTRATO -->
<section id="contrato" class="section">
  <!-- Controles - NÃƒO aparecem na impressÃ£o -->
  <div class="contract-controls">
    <div class="card-title">ğŸ“„ Gerar Contrato</div>
    
    <div class="form-group">
      <label class="form-label">Selecionar Evento</label>
      <select id="contrato_evento" class="form-control" onchange="carregarDadosContrato()">
        <option value="">-- Escolha um evento --</option>
      </select>
    </div>
  </div>

  <!-- ÃREA DE IMPRESSÃƒO - Apenas isto aparece no PDF -->
  <div id="contractPrintArea" style="display: none;">
    <!-- ConteÃºdo do contrato inserido via JS -->
  </div>

  <!-- Assinatura Digital - NÃƒO aparece na impressÃ£o -->
  <div id="assinaturaContainer" class="signature-pad-container" style="display: none;">
    <div class="card-title">âœï¸ Assinatura Digital do Cliente</div>
    <p style="color: var(--text-muted); margin-bottom: 10px; font-size: 14px;">
      PeÃ§a para o cliente assinar no quadro abaixo com o dedo ou caneta:
    </p>
    <canvas id="assinaturaCanvas" class="signature-pad"></canvas>
    <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
      <button class="btn btn-sm btn-secondary" onclick="limparAssinatura()">ğŸ§¹ Limpar</button>
      <button class="btn btn-sm btn-success" onclick="salvarAssinatura()">ğŸ’¾ Salvar Assinatura</button>
      <button class="btn btn-sm btn-primary" onclick="imprimirContrato()">ğŸ–¨ï¸ Imprimir / PDF</button>
      <button class="btn btn-sm btn-success" onclick="compartilharContrato()">ğŸ“¤ Compartilhar</button>
    </div>
  </div>
</section>

<!-- RECIBO COM CONTROLE FINANCEIRO -->
<section id="recibo" class="section">
  <div class="card">
    <div class="card-title">ğŸ§¾ Emitir Recibo</div>
    
    <div class="form-group">
      <label class="form-label">Selecionar Evento</label>
      <select id="recibo_evento" class="form-control" onchange="carregarDadosRecibo()">
        <option value="">-- Escolha um evento --</option>
      </select>
    </div>

    <!-- Resumo Financeiro do Evento -->
    <div id="resumoFinanceiro" style="display: none; margin-bottom: 20px;">
      <div class="section-group" style="background: linear-gradient(135deg, var(--info) 0%, var(--primary) 100%); color: white;">
        <div class="section-group-title" style="color: white;">ğŸ’° SituaÃ§Ã£o Financeira do Evento</div>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 15px;">
          <div>
            <div style="font-size: 12px; opacity: 0.9;">Valor Total</div>
            <div style="font-size: 20px; font-weight: 700;" id="finTotal">R$ 0,00</div>
          </div>
          <div>
            <div style="font-size: 12px; opacity: 0.9;">Total Recebido</div>
            <div style="font-size: 20px; font-weight: 700;" id="finRecebido">R$ 0,00</div>
          </div>
        </div>
        <div style="margin-bottom: 10px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
            <span>Saldo Devedor:</span>
            <span style="font-weight: 700;" id="finSaldo">R$ 0,00</span>
          </div>
          <div class="progress-bar" style="background: rgba(255,255,255,0.3);">
            <div class="progress-fill" id="finProgresso" style="width: 0%; background: white; color: var(--primary);">0%</div>
          </div>
        </div>
        <div style="font-size: 12px; opacity: 0.9; margin-top: 10px;" id="finStatus">
          Status: Pendente
        </div>
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Valor a Receber Agora (R$)</label>
        <input type="number" id="recibo_valor" class="form-control" step="0.01" onchange="validarValorRecibo()">
        <small style="color: var(--text-muted);">MÃ¡ximo: <span id="valorMaximo">R$ 0,00</span></small>
      </div>
      <div class="form-group">
        <label class="form-label">Data do Pagamento</label>
        <input type="date" id="recibo_data" class="form-control">
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">Forma de Pagamento</label>
      <select id="recibo_forma" class="form-control">
        <option value="Dinheiro">ğŸ’µ Dinheiro</option>
        <option value="Pix">âš¡ Pix</option>
        <option value="CartÃ£o de CrÃ©dito">ğŸ’³ CartÃ£o de CrÃ©dito</option>
        <option value="CartÃ£o de DÃ©bito">ğŸ’³ CartÃ£o de DÃ©bito</option>
        <option value="TransferÃªncia">ğŸ¦ TransferÃªncia</option>
        <option value="Boleto">ğŸ“„ Boleto</option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label">Referente a</label>
      <input type="text" id="recibo_referente" class="form-control" placeholder="Ex: ServiÃ§os de DJ - Casamento">
    </div>

    <div class="document-preview" id="previewRecibo" style="display: none;"></div>

    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 20px;">
      <button class="btn btn-primary" onclick="gerarRecibo()">
        ğŸ‘ï¸ Visualizar
      </button>
      <button class="btn btn-success" onclick="salvarRecibo()">
        ğŸ’¾ Salvar Recibo
      </button>
    </div>
  </div>

  <div class="card">
    <div class="card-title">ğŸ“‹ HistÃ³rico de Recibos</div>
    <div id="listaRecibos">
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ“­</div>
        <p>Nenhum recibo emitido</p>
      </div>
    </div>
  </div>
</section>

<!-- CAIXA/FINANCEIRO -->
<section id="caixa" class="section">
  <div class="card">
    <div class="card-title">ğŸ’° Controle Financeiro (Caixa)</div>
    
    <div class="stats-grid" style="margin-bottom: 20px;">
      <div class="stat-card">
        <div class="stat-value" id="cxTotalReceber">R$ 0</div>
        <div class="stat-label">A Receber</div>
      </div>
      <div class="stat-card" style="background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);">
        <div class="stat-value" id="cxTotalRecebido">R$ 0</div>
        <div class="stat-label">Recebido</div>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">Filtrar por Status</label>
      <select id="caixa_filtro" class="form-control" onchange="renderizarCaixa()">
        <option value="todos">Todos os Eventos</option>
        <option value="pendente">â³ Pendentes</option>
        <option value="parcial">ğŸ’µ Parcialmente Pago</option>
        <option value="pago">âœ… Quitados</option>
        <option value="atrasado">âš ï¸ Atrasados</option>
      </select>
    </div>

    <div id="listaCaixa">
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ“­</div>
        <p>Nenhum evento encontrado</p>
      </div>
    </div>
  </div>
</section>

<!-- LISTA DE EVENTOS -->
<section id="lista" class="section">
  <div class="card">
    <div class="card-title">ğŸ“… Todos os Eventos</div>
    
    <div class="form-group">
      <input type="text" id="buscaEvento" class="form-control" placeholder="ğŸ” Buscar evento..." onkeyup="filtrarEventos()">
    </div>

    <div id="listaEventos">
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ“­</div>
        <p>Nenhum evento cadastrado</p>
      </div>
    </div>
  </div>
</section>

<!-- PERFIL/CONFIGURAÃ‡Ã•ES -->
<section id="perfil" class="section">
  <div class="profile-header">
    <div class="profile-avatar" id="profileAvatar">ğŸ§</div>
    <div class="profile-name" id="profileName">Meu Nome</div>
    <div class="profile-role">DJ Profissional</div>
  </div>

  <!-- DADOS PESSOAIS DO CONTRATADO -->
  <div class="card">
    <div class="card-title">âœï¸ Dados Pessoais (Contratado)</div>
    
    <div class="form-group">
      <label class="form-label">Nome ArtÃ­stico / Nome Fantasia *</label>
      <input type="text" id="config_nome" class="form-control" placeholder="Como vocÃª Ã© conhecido">
    </div>

    <div class="form-group">
      <label class="form-label">Nome Completo (para documentos) *</label>
      <input type="text" id="config_nome_completo" class="form-control" placeholder="Nome completo legal">
    </div>

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">CPF *</label>
        <input type="text" id="config_cpf" class="form-control" placeholder="000.000.000-00">
      </div>
      <div class="form-group">
        <label class="form-label">RG</label>
        <input type="text" id="config_rg" class="form-control" placeholder="00.000.000-0">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Data de Nascimento</label>
        <input type="date" id="config_nascimento" class="form-control">
      </div>
      <div class="form-group">
        <label class="form-label">Estado Civil</label>
        <select id="config_estado_civil" class="form-control">
          <option value="">Selecione...</option>
          <option value="Solteiro(a)">Solteiro(a)</option>
          <option value="Casado(a)">Casado(a)</option>
          <option value="Divorciado(a)">Divorciado(a)</option>
          <option value="ViÃºvo(a)">ViÃºvo(a)</option>
        </select>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">Nacionalidade</label>
      <input type="text" id="config_nacionalidade" class="form-control" placeholder="Brasileiro(a)">
    </div>

    <div class="form-group">
      <label class="form-label">ProfissÃ£o</label>
      <input type="text" id="config_profissao" class="form-control" placeholder="DJ / MÃºsico / Produtor de Eventos">
    </div>
  </div>

  <!-- CONTATO -->
  <div class="card">
    <div class="card-title">ğŸ“ InformaÃ§Ãµes de Contato</div>
    
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Telefone Principal *</label>
        <input type="tel" id="config_telefone" class="form-control" placeholder="(00) 00000-0000">
      </div>
      <div class="form-group">
        <label class="form-label">Telefone SecundÃ¡rio</label>
        <input type="tel" id="config_telefone2" class="form-control" placeholder="(00) 00000-0000">
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">Email *</label>
      <input type="email" id="config_email" class="form-control" placeholder="contato@exemplo.com">
    </div>

    <div class="form-group">
      <label class="form-label">Website</label>
      <input type="url" id="config_website" class="form-control" placeholder="https://www.seusite.com">
    </div>

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Instagram</label>
        <input type="text" id="config_instagram" class="form-control" placeholder="@seuinstagram">
      </div>
      <div class="form-group">
        <label class="form-label">Facebook</label>
        <input type="text" id="config_facebook" class="form-control" placeholder="facebook.com/seuperfil">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">YouTube</label>
        <input type="text" id="config_youtube" class="form-control" placeholder="youtube.com/seucanal">
      </div>
      <div class="form-group">
        <label class="form-label">WhatsApp Business</label>
        <input type="text" id="config_whatsapp" class="form-control" placeholder="Link do WhatsApp">
      </div>
    </div>
  </div>

  <!-- ENDEREÃ‡O -->
  <div class="card">
    <div class="card-title">ğŸ  EndereÃ§o Completo</div>
    
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">CEP</label>
        <input type="text" id="config_cep" class="form-control" placeholder="00000-000">
      </div>
      <div class="form-group">
        <label class="form-label">Logradouro (Rua/Avenida)</label>
        <input type="text" id="config_rua" class="form-control" placeholder="Nome da rua">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">NÃºmero</label>
        <input type="text" id="config_numero" class="form-control" placeholder="123">
      </div>
      <div class="form-group">
        <label class="form-label">Complemento</label>
        <input type="text" id="config_complemento" class="form-control" placeholder="Apto, Sala, etc">
      </div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Bairro</label>
        <input type="text" id="config_bairro" class="form-control" placeholder="Bairro">
      </div>
      <div class="form-group">
        <label class="form-label">Cidade</label>
        <input type="text" id="config_cidade" class="form-control" placeholder="Cidade">
      </div>
      <div class="form-group">
        <label class="form-label">Estado</label>
        <select id="config_estado" class="form-control">
          <option value="">UF</option>
          <option value="AC">AC</option>
          <option value="AL">AL</option>
          <option value="AP">AP</option>
          <option value="AM">AM</option>
          <option value="BA">BA</option>
          <option value="CE">CE</option>
          <option value="DF">DF</option>
          <option value="ES">ES</option>
          <option value="GO">GO</option>
          <option value="MA">MA</option>
          <option value="MT">MT</option>
          <option value="MS">MS</option>
          <option value="MG">MG</option>
          <option value="PA">PA</option>
          <option value="PB">PB</option>
          <option value="PR">PR</option>
          <option value="PE">PE</option>
          <option value="PI">PI</option>
          <option value="RJ">RJ</option>
          <option value="RN">RN</option>
          <option value="RS">RS</option>
          <option value="RO">RO</option>
          <option value="RR">RR</option>
          <option value="SC">SC</option>
          <option value="SP">SP</option>
          <option value="SE">SE</option>
          <option value="TO">TO</option>
        </select>
      </div>
    </div>
  </div>

  <!-- DADOS BANCÃRIOS -->
  <div class="card">
    <div class="card-title">ğŸ¦ Dados BancÃ¡rios e Pix</div>
    
    <div class="form-group">
      <label class="form-label">Chave Pix Principal</label>
      <input type="text" id="config_pix" class="form-control" placeholder="CPF, Email, Telefone ou Chave AleatÃ³ria">
    </div>

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Banco</label>
        <input type="text" id="config_banco" class="form-control" placeholder="Nome do Banco">
      </div>
      <div class="form-group">
        <label class="form-label">AgÃªncia</label>
        <input type="text" id="config_agencia" class="form-control" placeholder="0000">
      </div>
      <div class="form-group">
        <label class="form-label">Conta</label>
        <input type="text" id="config_conta" class="form-control" placeholder="00000-0">
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">Nome do Titular da Conta</label>
      <input type="text" id="config_titular_conta" class="form-control" placeholder="Nome completo como estÃ¡ no banco">
    </div>
  </div>

  <!-- DADOS PROFISSIONAIS -->
  <div class="card">
    <div class="card-title">ğŸ§ InformaÃ§Ãµes Profissionais</div>
    
    <div class="form-group">
      <label class="form-label">CNPJ (se tiver empresa)</label>
      <input type="text" id="config_cnpj" class="form-control" placeholder="00.000.000/0000-00">
    </div>

    <div class="form-group">
      <label class="form-label">Nome da Empresa</label>
      <input type="text" id="config_empresa" class="form-control" placeholder="RazÃ£o Social">
    </div>

    <div class="form-group">
      <label class="form-label">InscriÃ§Ã£o Municipal/Estadual</label>
      <input type="text" id="config_inscricao" class="form-control" placeholder="NÃºmero da inscriÃ§Ã£o">
    </div>

    <div class="form-group">
      <label class="form-label">Especialidades</label>
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
          <input type="checkbox" id="esp_casamentos"> ğŸ’’ Casamentos
        </label>
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
          <input type="checkbox" id="esp_aniversarios"> ğŸ‚ AniversÃ¡rios
        </label>
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
          <input type="checkbox" id="esp_corporativos"> ğŸ’¼ Eventos Corporativos
        </label>
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
          <input type="checkbox" id="esp_formaturas"> ğŸ“ Formaturas
        </label>
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
          <input type="checkbox" id="esp_infantis"> ğŸ§’ Festas Infantis
        </label>
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
          <input type="checkbox" id="esp_debutantes"> ğŸ‘¸ Debutantes
        </label>
      </div>
    </div>
  </div>

  <!-- CONFIGURAÃ‡Ã•ES DO CONTRATO -->
  <div class="card">
    <div class="card-title">ğŸ“„ ConfiguraÃ§Ãµes do Contrato</div>
    
    <div class="form-group">
      <label class="form-label">ClÃ¡usula PadrÃ£o do Contrato</label>
      <textarea id="config_clausula" class="form-control" rows="6" placeholder="Texto padrÃ£o que aparecerÃ¡ em todos os contratos..."></textarea>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Multa por Cancelamento (%)</label>
        <input type="number" id="config_multa" class="form-control" placeholder="30" min="0" max="100">
      </div>
      <div class="form-group">
        <label class="form-label">Prazo de DesistÃªncia (dias)</label>
        <input type="number" id="config_prazo_desistencia" class="form-control" placeholder="7" min="0">
      </div>
    </div>
  </div>

  <!-- PERSONALIZAÃ‡ÃƒO -->
  <div class="card">
    <div class="card-title">ğŸ¨ PersonalizaÃ§Ã£o do App</div>
    
    <div class="form-group">
      <label class="form-label">Cor do Tema</label>
      <div class="color-picker">
        <div class="color-option selected" style="background: #0b76d1;" data-color="blue" onclick="changeColor('blue')">âœ“</div>
        <div class="color-option" style="background: #6f42c1;" data-color="purple" onclick="changeColor('purple')"></div>
        <div class="color-option" style="background: #28a745;" data-color="green" onclick="changeColor('green')"></div>
        <div class="color-option" style="background: #dc3545;" data-color="red" onclick="changeColor('red')"></div>
        <div class="color-option" style="background: #fd7e14;" data-color="orange" onclick="changeColor('orange')"></div>
        <div class="color-option" style="background: #e83e8c;" data-color="pink" onclick="changeColor('pink')"></div>
        <div class="color-option" style="background: #343a40;" data-color="black" onclick="changeColor('black')"></div>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">Modo Escuro</label>
      <button class="btn btn-secondary" onclick="toggleTheme()" style="width: 100%;">
        <span id="themeBtnText">ğŸŒ™ Ativar Modo Escuro</span>
      </button>
    </div>
  </div>

  <!-- SEGURANÃ‡A -->
  <div class="card">
    <div class="card-title">ğŸ” SeguranÃ§a</div>
    
    <div class="form-group">
      <label class="form-label">PIN de Acesso (4 dÃ­gitos)</label>
      <input type="password" id="config_pin" class="form-control" placeholder="0000" maxlength="4">
      <small style="color: var(--text-muted); display: block; margin-top: 5px;">Deixe em branco para desativar</small>
    </div>

    <button class="btn btn-primary btn-lg" onclick="salvarConfiguracoes()">
      ğŸ”’ Salvar ConfiguraÃ§Ãµes
    </button>
  </div>

  <!-- BACKUP -->
  <div class="card">
    <div class="card-title">ğŸ’¾ Backup e Dados</div>
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
      <button class="btn btn-secondary" onclick="exportarDados()">
        ğŸ“¤ Exportar Dados
      </button>
      <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">
        ğŸ“¥ Importar Dados
      </button>
      <input type="file" id="importFile" style="display: none;" accept=".json" onchange="importarDados(this)">
      <button class="btn btn-danger" onclick="limparTodosDados()">
        ğŸ—‘ï¸ Limpar Tudo
      </button>
    </div>
  </div>

  <div class="card" style="text-align: center; color: var(--text-muted);">
    <p>DJ Pro v3.0 - Sistema Profissional</p>
    <p style="font-size: 12px; margin-top: 5px;">Criado para DJs e Profissionais de Eventos</p>
  </div>
</section>

</main>

<!-- NAVEGAÃ‡ÃƒO INFERIOR -->
<nav class="bottom-nav">
  <button class="nav-item active" onclick="showTab('dashboard')">
    <span class="icon">ğŸ“Š</span>
    <span>InÃ­cio</span>
  </button>
  <button class="nav-item" onclick="showTab('cadastro')">
    <span class="icon">â•</span>
    <span>Novo</span>
  </button>
  <button class="nav-item" onclick="showTab('lista')">
    <span class="icon">ğŸ“…</span>
    <span>Eventos</span>
  </button>
  <button class="nav-item" onclick="showTab('caixa')">
    <span class="icon">ğŸ’°</span>
    <span>Caixa</span>
  </button>
  <button class="nav-item" onclick="showTab('perfil')">
    <span class="icon">ğŸ‘¤</span>
    <span>Perfil</span>
  </button>
</nav>

<!-- MODAL DE CONFIGURAÃ‡Ã•ES RÃPIDAS -->
<div id="modalConfig" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-header">
      <h3>âš™ï¸ ConfiguraÃ§Ãµes RÃ¡pidas</h3>
      <button class="modal-close" onclick="closeModal('config')">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Acesso RÃ¡pido</label>
        <button class="btn btn-secondary" onclick="closeModal('config'); showTab('perfil')" style="width: 100%; margin-bottom: 10px;">
          âœï¸ Editar Meus Dados
        </button>
        <button class="btn btn-secondary" onclick="closeModal('config'); toggleTheme()" style="width: 100%; margin-bottom: 10px;">
          ğŸŒ“ Alternar Tema
        </button>
        <button class="btn btn-secondary" onclick="closeModal('config'); exportarDados()" style="width: 100%;">
          ğŸ’¾ Fazer Backup
        </button>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn" onclick="closeModal('config')">Fechar</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toast" class="toast"></div>

<script>
// ==================== DADOS E CONFIGURAÃ‡Ã•ES ====================

let config = {
  nome: 'DJ Profissional',
  nomeCompleto: '',
  cpf: '',
  rg: '',
  nascimento: '',
  estadoCivil: '',
  nacionalidade: 'Brasileiro(a)',
  profissao: 'DJ',
  telefone: '',
  telefone2: '',
  email: '',
  website: '',
  instagram: '',
  facebook: '',
  youtube: '',
  whatsapp: '',
  cep: '',
  rua: '',
  numero: '',
  complemento: '',
  bairro: '',
  cidade: '',
  estado: '',
  pix: '',
  banco: '',
  agencia: '',
  conta: '',
  titularConta: '',
  cnpj: '',
  empresa: '',
  inscricao: '',
  especialidades: [],
  clausula: 'O contratado se compromete a prestar serviÃ§os de DJ com equipamento profissional, iluminaÃ§Ã£o e sonorizaÃ§Ã£o adequada para o evento. O pagamento deve ser efetuado conforme combinado.',
  multa: 30,
  prazoDesistencia: 7,
  cor: 'blue',
  pin: '',
  temaEscuro: false
};

let eventos = [];
let recibos = [];
let assinaturas = {};
let currentPin = '';
let isDrawing = false;
let canvas, ctx;
let currentEventoId = null;

// ==================== INICIALIZAÃ‡ÃƒO ====================

document.addEventListener('DOMContentLoaded', function() {
  carregarDados();
  verificarPin();
  atualizarDashboard();
  atualizarSelects();
  renderizarEventos();
  renderizarRecibos();
  renderizarCaixa();
  
  const hoje = new Date().toISOString().split('T')[0];
  document.getElementById('evt_data').value = hoje;
  document.getElementById('recibo_data').value = hoje;
});

// ==================== SISTEMA DE PIN ====================

function verificarPin() {
  if (config.pin && config.pin.length === 4) {
    document.getElementById('loginScreen').style.display = 'flex';
    document.getElementById('loginTitle').textContent = config.nome;
  } else {
    document.getElementById('loginScreen').style.display = 'none';
  }
}

function enterPin(num) {
  if (currentPin.length < 4) {
    currentPin += num;
    updatePinDisplay();
    
    if (currentPin.length === 4) {
      setTimeout(() => {
        if (currentPin === config.pin) {
          document.getElementById('loginScreen').style.display = 'none';
          showToast('Bem-vindo! ğŸ§');
        } else {
          showToast('PIN incorreto!', 'error');
          clearPin();
        }
      }, 300);
    }
  }
}

function clearPin() {
  currentPin = '';
  updatePinDisplay();
}

function updatePinDisplay() {
  const dots = document.querySelectorAll('.pin-dot');
  dots.forEach((dot, index) => {
    if (index < currentPin.length) {
      dot.classList.add('filled');
    } else {
      dot.classList.remove('filled');
    }
  });
}

function skipLogin() {
  document.getElementById('loginScreen').style.display = 'none';
}

// ==================== NAVEGAÃ‡ÃƒO ====================

function showTab(tabId) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  
  document.getElementById(tabId).classList.add('active');
  
  const navItems = document.querySelectorAll('.nav-item');
  const tabIndex = ['dashboard', 'cadastro', 'lista', 'caixa', 'perfil'].indexOf(tabId);
  if (tabIndex >= 0) navItems[tabIndex].classList.add('active');
  
  if (tabId === 'dashboard') atualizarDashboard();
  if (tabId === 'lista') renderizarEventos();
  if (tabId === 'caixa') renderizarCaixa();
  if (tabId === 'recibo') atualizarSelects();
  if (tabId === 'contrato') atualizarSelects();
  if (tabId === 'perfil') carregarConfiguracoes();
  
  window.scrollTo(0, 0);
}

function showModal(modalId) {
  document.getElementById('modal' + modalId.charAt(0).toUpperCase() + modalId.slice(1)).classList.add('active');
}

function closeModal(modalId) {
  document.getElementById('modal' + modalId.charAt(0).toUpperCase() + modalId.slice(1)).classList.remove('active');
}

// ==================== CONFIGURAÃ‡Ã•ES DO PERFIL ====================

function carregarConfiguracoes() {
  document.getElementById('config_nome').value = config.nome;
  document.getElementById('config_nome_completo').value = config.nomeCompleto;
  document.getElementById('config_cpf').value = config.cpf;
  document.getElementById('config_rg').value = config.rg || '';
  document.getElementById('config_nascimento').value = config.nascimento || '';
  document.getElementById('config_estado_civil').value = config.estadoCivil || '';
  document.getElementById('config_nacionalidade').value = config.nacionalidade || 'Brasileiro(a)';
  document.getElementById('config_profissao').value = config.profissao || '';
  document.getElementById('config_telefone').value = config.telefone;
  document.getElementById('config_telefone2').value = config.telefone2 || '';
  document.getElementById('config_email').value = config.email;
  document.getElementById('config_website').value = config.website || '';
  document.getElementById('config_instagram').value = config.instagram || '';
  document.getElementById('config_facebook').value = config.facebook || '';
  document.getElementById('config_youtube').value = config.youtube || '';
  document.getElementById('config_whatsapp').value = config.whatsapp || '';
  document.getElementById('config_cep').value = config.cep || '';
  document.getElementById('config_rua').value = config.rua || '';
  document.getElementById('config_numero').value = config.numero || '';
  document.getElementById('config_complemento').value = config.complemento || '';
  document.getElementById('config_bairro').value = config.bairro || '';
  document.getElementById('config_cidade').value = config.cidade || '';
  document.getElementById('config_estado').value = config.estado || '';
  document.getElementById('config_pix').value = config.pix || '';
  document.getElementById('config_banco').value = config.banco || '';
  document.getElementById('config_agencia').value = config.agencia || '';
  document.getElementById('config_conta').value = config.conta || '';
  document.getElementById('config_titular_conta').value = config.titularConta || '';
  document.getElementById('config_cnpj').value = config.cnpj || '';
  document.getElementById('config_empresa').value = config.empresa || '';
  document.getElementById('config_inscricao').value = config.inscricao || '';
  document.getElementById('config_clausula').value = config.clausula;
  document.getElementById('config_multa').value = config.multa || 30;
  document.getElementById('config_prazo_desistencia').value = config.prazoDesistencia || 7;
  document.getElementById('config_pin').value = config.pin;
  
  if (config.especialidades) {
    document.getElementById('esp_casamentos').checked = config.especialidades.includes('casamentos');
    document.getElementById('esp_aniversarios').checked = config.especialidades.includes('aniversarios');
    document.getElementById('esp_corporativos').checked = config.especialidades.includes('corporativos');
    document.getElementById('esp_formaturas').checked = config.especialidades.includes('formaturas');
    document.getElementById('esp_infantis').checked = config.especialidades.includes('infantis');
    document.getElementById('esp_debutantes').checked = config.especialidades.includes('debutantes');
  }
  
  document.getElementById('profileName').textContent = config.nome;
  document.getElementById('appTitle').textContent = config.nome;
  
  document.querySelectorAll('.color-option').forEach(opt => {
    opt.classList.remove('selected');
    opt.textContent = '';
    if (opt.dataset.color === config.cor) {
      opt.classList.add('selected');
      opt.textContent = 'âœ“';
    }
  });
}

function salvarConfiguracoes() {
  config.nome = document.getElementById('config_nome').value || 'DJ Profissional';
  config.nomeCompleto = document.getElementById('config_nome_completo').value;
  config.cpf = document.getElementById('config_cpf').value;
  config.rg = document.getElementById('config_rg').value;
  config.nascimento = document.getElementById('config_nascimento').value;
  config.estadoCivil = document.getElementById('config_estado_civil').value;
  config.nacionalidade = document.getElementById('config_nacionalidade').value || 'Brasileiro(a)';
  config.profissao = document.getElementById('config_profissao').value;
  config.telefone = document.getElementById('config_telefone').value;
  config.telefone2 = document.getElementById('config_telefone2').value;
  config.email = document.getElementById('config_email').value;
  config.website = document.getElementById('config_website').value;
  config.instagram = document.getElementById('config_instagram').value;
  config.facebook = document.getElementById('config_facebook').value;
  config.youtube = document.getElementById('config_youtube').value;
  config.whatsapp = document.getElementById('config_whatsapp').value;
  config.cep = document.getElementById('config_cep').value;
  config.rua = document.getElementById('config_rua').value;
  config.numero = document.getElementById('config_numero').value;
  config.complemento = document.getElementById('config_complemento').value;
  config.bairro = document.getElementById('config_bairro').value;
  config.cidade = document.getElementById('config_cidade').value;
  config.estado = document.getElementById('config_estado').value;
  config.pix = document.getElementById('config_pix').value;
  config.banco = document.getElementById('config_banco').value;
  config.agencia = document.getElementById('config_agencia').value;
  config.conta = document.getElementById('config_conta').value;
  config.titularConta = document.getElementById('config_titular_conta').value;
  config.cnpj = document.getElementById('config_cnpj').value;
  config.empresa = document.getElementById('config_empresa').value;
  config.inscricao = document.getElementById('config_inscricao').value;
  config.especialidades = [];
  if (document.getElementById('esp_casamentos').checked) config.especialidades.push('casamentos');
  if (document.getElementById('esp_aniversarios').checked) config.especialidades.push('aniversarios');
  if (document.getElementById('esp_corporativos').checked) config.especialidades.push('corporativos');
  if (document.getElementById('esp_formaturas').checked) config.especialidades.push('formaturas');
  if (document.getElementById('esp_infantis').checked) config.especialidades.push('infantis');
  if (document.getElementById('esp_debutantes').checked) config.especialidades.push('debutantes');
  config.clausula = document.getElementById('config_clausula').value;
  config.multa = document.getElementById('config_multa').value || 30;
  config.prazoDesistencia = document.getElementById('config_prazo_desistencia').value || 7;
  config.pin = document.getElementById('config_pin').value;
  
  salvarDados();
  carregarConfiguracoes();
  showToast('âœ… Dados salvos com sucesso!');
  
  if (config.pin && config.pin.length === 4) {
    showToast('ğŸ” PIN ativado!', 'warning');
  }
}

function changeColor(color) {
  config.cor = color;
  document.body.setAttribute('data-color', color);
  
  document.querySelectorAll('.color-option').forEach(opt => {
    opt.classList.remove('selected');
    opt.textContent = '';
    if (opt.dataset.color === color) {
      opt.classList.add('selected');
      opt.textContent = 'âœ“';
    }
  });
  
  salvarDados();
}

function toggleTheme() {
  config.temaEscuro = !config.temaEscuro;
  if (config.temaEscuro) {
    document.body.setAttribute('data-theme', 'dark');
    document.getElementById('themeBtnText').textContent = 'â˜€ï¸ Desativar Modo Escuro';
  } else {
    document.body.removeAttribute('data-theme');
    document.getElementById('themeBtnText').textContent = 'ğŸŒ™ Ativar Modo Escuro';
  }
  salvarDados();
}

// ==================== EVENTOS ====================

function salvarEvento() {
  const id = document.getElementById('editId').value;
  const nome = document.getElementById('cli_nome').value;
  const data = document.getElementById('evt_data').value;
  const valor = parseFloat(document.getElementById('evt_valor').value);
  const tel = document.getElementById('cli_tel').value;
  
  if (!nome || !data || !valor || !tel) {
    showToast('âŒ Preencha todos os campos obrigatÃ³rios!', 'error');
    return;
  }
  
  const evento = {
    id: id || Date.now().toString(),
    nome: nome,
    cpf: document.getElementById('cli_cpf').value,
    rg: document.getElementById('cli_rg').value,
    telefone: tel,
    email: document.getElementById('cli_email').value,
    endereco: document.getElementById('cli_endereco').value,
    profissao: document.getElementById('cli_profissao').value,
    estadoCivil: document.getElementById('cli_estado_civil').value,
    data: data,
    horaInicio: document.getElementById('evt_hora_inicio').value,
    horaFim: document.getElementById('evt_hora_fim').value,
    local: document.getElementById('evt_local').value,
    localEndereco: document.getElementById('evt_local_endereco').value,
    tipo: document.getElementById('evt_tipo').value,
    convidados: document.getElementById('evt_convidados').value,
    valor: valor,
    sinal: parseFloat(document.getElementById('evt_sinal').value) || 0,
    formaPagamento: document.getElementById('evt_forma_pgto').value,
    vencimento: document.getElementById('evt_vencimento').value,
    statusPagamento: document.getElementById('evt_status_pgto').value,
    equipamentos: {
      som: document.getElementById('equip_som').checked,
      luz: document.getElementById('equip_luz').checked,
      microfone: document.getElementById('equip_microfone').checked,
      projetor: document.getElementById('equip_projetor').checked,
      fumaca: document.getElementById('equip_fumaca').checked,
      bolhas: document.getElementById('equip_bolhas').checked
    },
    observacoes: document.getElementById('evt_obs').value,
    status: document.getElementById('evt_status').value,
    dataCadastro: new Date().toISOString()
  };
  
  if (id) {
    const index = eventos.findIndex(e => e.id === id);
    if (index >= 0) eventos[index] = evento;
  } else {
    eventos.push(evento);
  }
  
  salvarDados();
  limparFormulario();
  showToast(id ? 'âœ… Evento atualizado!' : 'âœ… Evento cadastrado!');
  showTab('lista');
}

function limparFormulario() {
  document.getElementById('editId').value = '';
  document.getElementById('cli_nome').value = '';
  document.getElementById('cli_cpf').value = '';
  document.getElementById('cli_rg').value = '';
  document.getElementById('cli_tel').value = '';
  document.getElementById('cli_email').value = '';
  document.getElementById('cli_endereco').value = '';
  document.getElementById('cli_profissao').value = '';
  document.getElementById('cli_estado_civil').value = '';
  document.getElementById('evt_data').value = new Date().toISOString().split('T')[0];
  document.getElementById('evt_hora_inicio').value = '';
  document.getElementById('evt_hora_fim').value = '';
  document.getElementById('evt_local').value = '';
  document.getElementById('evt_local_endereco').value = '';
  document.getElementById('evt_tipo').value = '';
  document.getElementById('evt_convidados').value = '';
  document.getElementById('evt_valor').value = '';
  document.getElementById('evt_sinal').value = '';
  document.getElementById('evt_forma_pgto').value = 'Pix';
  document.getElementById('evt_vencimento').value = '';
  document.getElementById('evt_status_pgto').value = 'pendente';
  document.getElementById('equip_som').checked = true;
  document.getElementById('equip_luz').checked = true;
  document.getElementById('equip_microfone').checked = false;
  document.getElementById('equip_projetor').checked = false;
  document.getElementById('equip_fumaca').checked = false;
  document.getElementById('equip_bolhas').checked = false;
  document.getElementById('evt_obs').value = '';
  document.getElementById('evt_status').value = 'agendado';
}

function editarEvento(id) {
  const evento = eventos.find(e => e.id === id);
  if (!evento) return;
  
  document.getElementById('editId').value = evento.id;
  document.getElementById('cli_nome').value = evento.nome;
  document.getElementById('cli_cpf').value = evento.cpf || '';
  document.getElementById('cli_rg').value = evento.rg || '';
  document.getElementById('cli_tel').value = evento.telefone;
  document.getElementById('cli_email').value = evento.email || '';
  document.getElementById('cli_endereco').value = evento.endereco || '';
  document.getElementById('cli_profissao').value = evento.profissao || '';
  document.getElementById('cli_estado_civil').value = evento.estadoCivil || '';
  document.getElementById('evt_data').value = evento.data;
  document.getElementById('evt_hora_inicio').value = evento.horaInicio || '';
  document.getElementById('evt_hora_fim').value = evento.horaFim || '';
  document.getElementById('evt_local').value = evento.local || '';
  document.getElementById('evt_local_endereco').value = evento.localEndereco || '';
  document.getElementById('evt_tipo').value = evento.tipo || '';
  document.getElementById('evt_convidados').value = evento.convidados || '';
  document.getElementById('evt_valor').value = evento.valor;
  document.getElementById('evt_sinal').value = evento.sinal || '';
  document.getElementById('evt_forma_pgto').value = evento.formaPagamento || 'Pix';
  document.getElementById('evt_vencimento').value = evento.vencimento || '';
  document.getElementById('evt_status_pgto').value = evento.statusPagamento || 'pendente';
  
  if (evento.equipamentos) {
    document.getElementById('equip_som').checked = evento.equipamentos.som;
    document.getElementById('equip_luz').checked = evento.equipamentos.luz;
    document.getElementById('equip_microfone').checked = evento.equipamentos.microfone;
    document.getElementById('equip_projetor').checked = evento.equipamentos.projetor;
    document.getElementById('equip_fumaca').checked = evento.equipamentos.fumaca;
    document.getElementById('equip_bolhas').checked = evento.equipamentos.bolhas;
  }
  
  document.getElementById('evt_obs').value = evento.observacoes || '';
  document.getElementById('evt_status').value = evento.status || 'agendado';
  
  showTab('cadastro');
  showToast('âœï¸ Editando evento...');
}

function excluirEvento(id) {
  if (!confirm('Tem certeza que deseja excluir este evento?')) return;
  
  eventos = eventos.filter(e => e.id !== id);
  recibos = recibos.filter(r => r.eventoId !== id);
  salvarDados();
  renderizarEventos();
  atualizarDashboard();
  showToast('ğŸ—‘ï¸ Evento excluÃ­do!');
}

function renderizarEventos() {
  const container = document.getElementById('listaEventos');
  const busca = document.getElementById('buscaEvento').value.toLowerCase();
  
  let filtrados = eventos;
  if (busca) {
    filtrados = eventos.filter(e => 
      e.nome.toLowerCase().includes(busca) || 
      (e.tipo && e.tipo.toLowerCase().includes(busca)) ||
      (e.local && e.local.toLowerCase().includes(busca))
    );
  }
  
  filtrados.sort((a, b) => new Date(b.data) - new Date(a.data));
  
  if (filtrados.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ“­</div>
        <p>${busca ? 'Nenhum evento encontrado' : 'Nenhum evento cadastrado'}</p>
      </div>
    `;
    return;
  }
  
  container.innerHTML = filtrados.map(e => {
    const data = new Date(e.data + 'T12:00:00');
    const dataStr = data.toLocaleDateString('pt-BR');
    const statusClass = {
      'agendado': 'badge-warning',
      'confirmado': 'badge-success',
      'em_andamento': 'badge-info',
      'concluido': 'badge-info',
      'cancelado': 'badge-danger',
      'adiado': 'badge-warning'
    }[e.status] || 'badge-warning';
    
    const statusText = {
      'agendado': 'ğŸ“… Agendado',
      'confirmado': 'âœ… Confirmado',
      'em_andamento': 'ğŸµ Em Andamento',
      'concluido': 'ğŸ‰ ConcluÃ­do',
      'cancelado': 'âŒ Cancelado',
      'adiado': 'â¸ï¸ Adiado'
    }[e.status] || 'Agendado';
    
    return `
      <div class="list-item">
        <div class="list-item-header">
          <div>
            <div class="list-item-title">${e.nome}</div>
            <div class="list-item-meta">
              ğŸ“… ${dataStr} ${e.horaInicio ? 'â° ' + e.horaInicio : ''}<br>
              ğŸ“ ${e.local || 'Local nÃ£o definido'}<br>
              ğŸ’° R$ ${e.valor.toFixed(2)} ${e.tipo ? 'â€¢ ' + e.tipo : ''}
            </div>
          </div>
          <span class="badge ${statusClass}">${statusText}</span>
        </div>
        <div class="list-item-actions">
          <button class="btn btn-sm btn-secondary" onclick="editarEvento('${e.id}')">âœï¸ Editar</button>
          <button class="btn btn-sm btn-primary" onclick="verEvento('${e.id}')">ğŸ‘ï¸ Ver</button>
          <button class="btn btn-sm btn-success" onclick="gerarContrato('${e.id}')">ğŸ“„ Contrato</button>
          <button class="btn btn-sm btn-warning" onclick="emitirRecibo('${e.id}')">ğŸ§¾ Recibo</button>
          <button class="btn btn-sm btn-danger" onclick="excluirEvento('${e.id}')">ğŸ—‘ï¸</button>
        </div>
      </div>
    `;
  }).join('');
}

function filtrarEventos() {
  renderizarEventos();
}

function verEvento(id) {
  const e = eventos.find(ev => ev.id === id);
  if (!e) return;
  
  let equipamentos = [];
  if (e.equipamentos) {
    if (e.equipamentos.som) equipamentos.push('Som');
    if (e.equipamentos.luz) equipamentos.push('IluminaÃ§Ã£o');
    if (e.equipamentos.microfone) equipamentos.push('Microfones');
    if (e.equipamentos.projetor) equipamentos.push('Projetor');
    if (e.equipamentos.fumaca) equipamentos.push('MÃ¡quina de FumaÃ§a');
    if (e.equipamentos.bolhas) equipamentos.push('MÃ¡quina de Bolhas');
  }
  
  const totalRecebido = calcularTotalRecebido(id);
  const saldo = e.valor - totalRecebido;
  
  alert(`ğŸ“… Evento: ${e.nome}
ğŸ“ Local: ${e.local || 'N/A'}
ğŸ  EndereÃ§o: ${e.localEndereco || 'N/A'}
ğŸ“† Data: ${new Date(e.data).toLocaleDateString('pt-BR')}
â° HorÃ¡rio: ${e.horaInicio || 'N/A'} Ã s ${e.horaFim || 'N/A'}
ğŸ‘¥ Convidados: ${e.convidados || 'N/A'}
ğŸ’° Valor Total: R$ ${e.valor.toFixed(2)}
ğŸ’µ Total Recebido: R$ ${totalRecebido.toFixed(2)}
ğŸ’³ Saldo: R$ ${saldo.toFixed(2)}
ğŸ§ Equipamentos: ${equipamentos.join(', ') || 'Nenhum'}
ğŸ“ Obs: ${e.observacoes || 'Nenhuma'}`);
}

// ==================== DASHBOARD ====================

function atualizarDashboard() {
  const total = eventos.reduce((sum, e) => e.status !== 'cancelado' ? sum + e.valor : sum, 0);
  const totalRecebido = recibos.reduce((sum, r) => sum + r.valor, 0);
  const pendentes = eventos.filter(e => {
    const recebido = calcularTotalRecebido(e.id);
    return e.status !== 'cancelado' && recebido < e.valor;
  }).length;
  
  document.getElementById('dashTotal').textContent = 'R$ ' + total.toFixed(2);
  document.getElementById('dashEventos').textContent = eventos.length;
  document.getElementById('dashRecibos').textContent = recibos.length;
  document.getElementById('dashPendentes').textContent = pendentes;
  
  const hoje = new Date();
  hoje.setHours(0,0,0,0);
  const proximos = eventos
    .filter(e => {
      const dataEvento = new Date(e.data + 'T12:00:00');
      const diff = Math.ceil((dataEvento - hoje) / (1000 * 60 * 60 * 24));
      return diff >= 0 && diff <= 7 && e.status !== 'cancelado';
    })
    .sort((a, b) => new Date(a.data) - new Date(b.data));
  
  const container = document.getElementById('listaProximos');
  if (proximos.length === 0) {
    container.innerHTML = `
      <div class="empty-state" style="padding: 30px;">
        <div class="empty-state-icon" style="font-size: 40px;">ğŸ“­</div>
        <p style="font-size: 14px;">Nenhum evento nos prÃ³ximos 7 dias</p>
      </div>
    `;
  } else {
    container.innerHTML = proximos.map(e => {
      const data = new Date(e.data + 'T12:00:00');
      const diff = Math.ceil((data - hoje) / (1000 * 60 * 60 * 24));
      const diasText = diff === 0 ? 'Hoje' : diff === 1 ? 'AmanhÃ£' : `Em ${diff} dias`;
      
      return `
        <div class="list-item" style="margin-bottom: 8px; padding: 15px;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <div style="font-weight: 700;">${e.nome}</div>
              <div style="font-size: 12px; color: var(--text-muted);">${e.tipo || 'Evento'} â€¢ ${e.horaInicio || 'HorÃ¡rio nÃ£o definido'}</div>
            </div>
            <span class="badge badge-info">${diasText}</span>
          </div>
        </div>
      `;
    }).join('');
  }
}

// ==================== CAIXA/FINANCEIRO ====================

function calcularTotalRecebido(eventoId) {
  return recibos
    .filter(r => r.eventoId === eventoId)
    .reduce((sum, r) => sum + r.valor, 0);
}

function renderizarCaixa() {
  const filtro = document.getElementById('caixa_filtro').value;
  const container = document.getElementById('listaCaixa');
  
  let totalReceber = 0;
  let totalRecebido = 0;
  
  let html = eventos.map(e => {
    if (e.status === 'cancelado') return '';
    
    const recebido = calcularTotalRecebido(e.id);
    const saldo = e.valor - recebido;
    const percentual = Math.round((recebido / e.valor) * 100);
    
    totalReceber += saldo;
    totalRecebido += recebido;
    
    if (filtro === 'pendente' && recebido > 0) return '';
    if (filtro === 'pago' && saldo > 0) return '';
    if (filtro === 'parcial' && (recebido === 0 || saldo === 0)) return '';
    if (filtro === 'atrasado') {
      const vencimento = e.vencimento ? new Date(e.vencimento) : null;
      if (!vencimento || vencimento > new Date() || saldo <= 0) return '';
    }
    
    const statusClass = saldo <= 0 ? 'badge-success' : recebido > 0 ? 'badge-warning' : 'badge-danger';
    const statusText = saldo <= 0 ? 'Quitado' : recebido > 0 ? 'Parcial' : 'Pendente';
    
    return `
      <div class="list-item">
        <div class="list-item-header">
          <div>
            <div class="list-item-title">${e.nome}</div>
            <div class="list-item-meta">
              ğŸ“… ${new Date(e.data).toLocaleDateString('pt-BR')} â€¢ ${e.tipo || 'Evento'}<br>
              ğŸ’° Total: R$ ${e.valor.toFixed(2)} â€¢ Recebido: R$ ${recebido.toFixed(2)}
            </div>
          </div>
          <span class="badge ${statusClass}">${statusText}</span>
        </div>
        <div style="margin: 10px 0;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 14px;">
            <span>Saldo: R$ ${saldo.toFixed(2)}</span>
            <span>${percentual}%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${percentual}%;">${percentual}%</div>
          </div>
        </div>
        <div class="list-item-actions">
          <button class="btn btn-sm btn-success" onclick="emitirRecibo('${e.id}')">ğŸ’µ Receber</button>
          <button class="btn btn-sm btn-primary" onclick="verEvento('${e.id}')">ğŸ‘ï¸ Detalhes</button>
        </div>
      </div>
    `;
  }).join('');
  
  document.getElementById('cxTotalReceber').textContent = 'R$ ' + totalReceber.toFixed(2);
  document.getElementById('cxTotalRecebido').textContent = 'R$ ' + totalRecebido.toFixed(2);
  
  container.innerHTML = html || `
    <div class="empty-state">
      <div class="empty-state-icon">ğŸ“­</div>
      <p>Nenhum evento encontrado</p>
    </div>
  `;
}

// ==================== CONTRATO ====================

function atualizarSelects() {
  const opts = eventos.map(e => `<option value="${e.id}">${e.nome} - ${new Date(e.data).toLocaleDateString('pt-BR')}</option>`).join('');
  document.getElementById('contrato_evento').innerHTML = '<option value="">-- Escolha um evento --</option>' + opts;
  document.getElementById('recibo_evento').innerHTML = '<option value="">-- Escolha um evento --</option>' + opts;
}

function carregarDadosContrato() {
  const id = document.getElementById('contrato_evento').value;
  
  if (!id) {
    document.getElementById('contractPrintArea').style.display = 'none';
    document.getElementById('assinaturaContainer').style.display = 'none';
    return;
  }
  
  currentEventoId = id;
  const e = eventos.find(ev => ev.id === id);
  if (!e) return;
  
  const data = new Date(e.data + 'T12:00:00').toLocaleDateString('pt-BR');
  const dataHoje = new Date().toLocaleDateString('pt-BR');
  
  const enderecoContratado = `${config.rua || ''}${config.numero ? ', ' + config.numero : ''}${config.complemento ? ' - ' + config.complemento : ''}${config.bairro ? ', ' + config.bairro : ''}${config.cidade ? ', ' + config.cidade : ''}${config.estado ? ' - ' + config.estado : ''}`;
  
  let equipamentosList = [];
  if (e.equipamentos) {
    if (e.equipamentos.som) equipamentosList.push('Sistema de Som completo');
    if (e.equipamentos.luz) equipamentosList.push('IluminaÃ§Ã£o profissional');
    if (e.equipamentos.microfone) equipamentosList.push('Microfones sem fio');
    if (e.equipamentos.projetor) equipamentosList.push('Projetor e telas');
    if (e.equipamentos.fumaca) equipamentosList.push('MÃ¡quina de fumaÃ§a');
    if (e.equipamentos.bolhas) equipamentosList.push('MÃ¡quina de bolhas');
  }
  
  const contratoHTML = `
    <h2>CONTRATO DE PRESTAÃ‡ÃƒO DE SERVIÃ‡OS DE DJ</h2>
    
    <p><strong>CONTRATADO:</strong> ${config.nomeCompleto || config.nome}, ${config.nacionalidade || 'Brasileiro(a)'}, ${config.estadoCivil || ''}, ${config.profissao || 'DJ'}, portador do CPF: ${config.cpf || 'N/A'}${config.rg ? ', RG: ' + config.rg : ''}, residente e domiciliado em ${enderecoContratado || 'N/A'}.</p>
    
    <p><strong>CONTRATANTE:</strong> ${e.nome}, ${e.estadoCivil || ''}${e.profissao ? ', ' + e.profissao : ''}, portador do CPF: ${e.cpf || 'N/A'}${e.rg ? ', RG: ' + e.rg : ''}, residente em ${e.endereco || 'N/A'}, Tel: ${e.telefone}${e.email ? ', Email: ' + e.email : ''}.</p>
    
    <p><strong>DO EVENTO:</strong> ${e.tipo || 'Evento'} a ser realizado no dia ${data}, no local ${e.local || 'A definir'}${e.localEndereco ? ' - ' + e.localEndereco : ''}. HorÃ¡rio previsto: ${e.horaInicio || 'A definir'} Ã s ${e.horaFim || 'tÃ©rmino'}. ServiÃ§os contratados: ${equipamentosList.join(', ') || 'DJ e sonorizaÃ§Ã£o'}.</p>
    
    <p><strong>CLÃUSULA 1Âª - DO OBJETO:</strong> O presente contrato tem por objeto a prestaÃ§Ã£o de serviÃ§os de DJ e sonorizaÃ§Ã£o para o evento descrito, incluindo montagem, operaÃ§Ã£o e desmontagem do sistema de som e iluminaÃ§Ã£o contratado.</p>
    
    <p><strong>CLÃUSULA 2Âª - DO PAGAMENTO:</strong> O valor total do serviÃ§o Ã© de R$ ${e.valor.toFixed(2)} (${valorPorExtenso(e.valor)}), a ser pago da seguinte forma: ${e.formaPagamento || 'A combinar'}. ${e.sinal ? 'Sinal de R$ ' + e.sinal.toFixed(2) + ' jÃ¡ pago.' : ''} O pagamento do sinal caracteriza reserva de data e nÃ£o serÃ¡ reembolsÃ¡vel em caso de desistÃªncia. Cancelamentos com menos de ${config.prazoDesistencia || 7} dias estÃ£o sujeitos a multa de ${config.multa || 30}% do valor total.</p>
    
    <p><strong>CLÃUSULA 3Âª - DAS OBRIGAÃ‡Ã•ES DO CONTRATANTE:</strong> Fornecer local adequado, energia elÃ©trica em 220V, estrutura para montagem (mesa/cobertura), seguranÃ§a dos equipamentos e acesso para carga/descarga. O CONTRATANTE Ã© responsÃ¡vel por obter licenÃ§as, alvarÃ¡s e pagamento de taxas ao ECAD se necessÃ¡rio.</p>
    
    <p><strong>CLÃUSULA 4Âª - DAS OBRIGAÃ‡Ã•ES DO CONTRATADO:</strong> Comparecer no horÃ¡rio estabelecido, trazer equipamentos em perfeito funcionamento, executar o serviÃ§o com profissionalismo e zelar pela boa execuÃ§Ã£o do evento.</p>
    
    <p><strong>CLÃUSULA 5Âª - DO CANCELAMENTO:</strong> Em caso de force majeure (doenÃ§a comprovada, acidente, desastre natural), o CONTRATADO poderÃ¡ indicar substituto de igual qualidade ou devolver valores pagos em atÃ© 7 dias. O CONTRATANTE pode remarcar uma vez sem custo com ${config.prazoDesistencia || 7} dias de antecedÃªncia.</p>
    
    <p><strong>CLÃUSULA 6Âª - DOS EQUIPAMENTOS:</strong> Os equipamentos sÃ£o de propriedade do CONTRATADO. Danos causados por negligÃªncia do CONTRATANTE ou seus convidados serÃ£o ressarcidos mediante apresentaÃ§Ã£o de nota fiscal.</p>
    
    <p><strong>CLÃUSULA 7Âª - DA INTERRUPÃ‡ÃƒO:</strong> O CONTRATADO pode interromper o serviÃ§o em caso de: falta de energia por mais de 30 minutos, condiÃ§Ãµes climÃ¡ticas adversas (eventos ao ar livre), violÃªncia ou situaÃ§Ãµes de risco, sem devoluÃ§Ã£o de valores.</p>
    
    <p><strong>CLÃUSULA 8Âª - DO HORÃRIO:</strong> O atraso superior a 60 minutos do CONTRATANTE nÃ£o obriga o CONTRATADO a estender o horÃ¡rio contratado. Horas extras serÃ£o cobradas conforme valor prÃ©-estabelecido.</p>
    
    <p><strong>CLÃUSULA 9Âª - DA IMAGEM:</strong> O CONTRATANTE autoriza o uso de imagens do evento para portfÃ³lio e divulgaÃ§Ã£o do CONTRATADO, exceto mediante solicitaÃ§Ã£o expressa em contrÃ¡rio por escrito.</p>
    
    <p><strong>CLÃUSULA 10Âª - DO FORO:</strong> Fica eleito o foro da comarca de ${config.cidade || 'N/A'}/${config.estado || 'SP'} para dirimir quaisquer controvÃ©rsias, com renÃºncia a qualquer outro, por mais privilegiado que seja.</p>
    
    <p><strong>CLÃUSULA 11Âª - DISPOSIÃ‡Ã•ES GERAIS:</strong> Este contrato pode ser assinado digitalmente ou fisicamente, tendo ambas as formas igual validade jurÃ­dica. A tolerÃ¢ncia de qualquer das partes quanto ao descumprimento nÃ£o implicarÃ¡ em renÃºncia ou novaÃ§Ã£o.</p>
    
    ${e.observacoes ? `<p><strong>OBSERVAÃ‡Ã•ES:</strong> ${e.observacoes}</p>` : ''}
    
    <p style="margin-top: 30px;">${config.cidade || 'N/A'}/${config.estado || 'SP'}, ${dataHoje}.</p>
    
    <div class="signature-area">
      <div class="signature-box">
        <div class="signature-line" id="assinaturaContratado">
          ${assinaturas[id] ? `<img src="${assinaturas[id]}" style="max-height: 75px; max-width: 90%;">` : ''}
        </div>
        <p><strong>${e.nome}</strong><br>CONTRATANTE<br><small>CPF: ${e.cpf || 'N/A'}</small></p>
      </div>
      <div class="signature-box">
        <div class="signature-line"></div>
        <p><strong>${config.nomeCompleto || config.nome}</strong><br>CONTRATADO<br><small>CPF: ${config.cpf || 'N/A'}</small></p>
      </div>
    </div>
  `;
  
  document.getElementById('contractPrintArea').innerHTML = contratoHTML;
  document.getElementById('contractPrintArea').style.display = 'block';
  document.getElementById('assinaturaContainer').style.display = 'block';
  
  // Inicializar canvas apÃ³s mostrar o container
  setTimeout(initCanvas, 100);
}

function gerarContrato(id) {
  showTab('contrato');
  setTimeout(() => {
    document.getElementById('contrato_evento').value = id;
    carregarDadosContrato();
  }, 100);
}

function imprimirContrato() {
  window.print();
}

function compartilharContrato() {
  const preview = document.getElementById('contractPrintArea').innerText;
  if (navigator.share) {
    navigator.share({
      title: 'Contrato de ServiÃ§os',
      text: preview.substring(0, 500) + '...'
    });
  } else {
    navigator.clipboard.writeText(preview);
    showToast('ğŸ“‹ Contrato copiado!');
  }
}

// ==================== ASSINATURA DIGITAL - VERSÃƒO CORRIGIDA ====================

function initCanvas() {
  canvas = document.getElementById('assinaturaCanvas');
  if (!canvas) {
    console.error('Canvas nÃ£o encontrado');
    return;
  }
  
  // Configurar tamanho do canvas
  const container = canvas.parentElement;
  const rect = container.getBoundingClientRect();
  
  // Definir tamanho considerando padding
  canvas.width = rect.width - 40;
  canvas.height = 250;
  
  // Obter contexto
  ctx = canvas.getContext('2d');
  
  // Configurar estilo da linha
  ctx.strokeStyle = '#000000';
  ctx.lineWidth = 3;
  ctx.lineCap = 'round';
  ctx.lineJoin = 'round';
  
  // Limpar canvas
  ctx.fillStyle = '#ffffff';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // Remover eventos antigos para evitar duplicaÃ§Ã£o
  canvas.removeEventListener('mousedown', handleMouseDown);
  canvas.removeEventListener('mousemove', handleMouseMove);
  canvas.removeEventListener('mouseup', handleMouseUp);
  canvas.removeEventListener('mouseout', handleMouseUp);
  canvas.removeEventListener('touchstart', handleTouchStart);
  canvas.removeEventListener('touchmove', handleTouchMove);
  canvas.removeEventListener('touchend', handleTouchEnd);
  
  // Adicionar novos eventos
  canvas.addEventListener('mousedown', handleMouseDown);
  canvas.addEventListener('mousemove', handleMouseMove);
  canvas.addEventListener('mouseup', handleMouseUp);
  canvas.addEventListener('mouseout', handleMouseUp);
  
  canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
  canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
  canvas.addEventListener('touchend', handleTouchEnd, { passive: false });
  
  console.log('Canvas inicializado:', canvas.width, 'x', canvas.height);
}

function getCanvasPos(e) {
  const rect = canvas.getBoundingClientRect();
  let clientX, clientY;
  
  if (e.touches && e.touches.length > 0) {
    clientX = e.touches[0].clientX;
    clientY = e.touches[0].clientY;
  } else {
    clientX = e.clientX;
    clientY = e.clientY;
  }
  
  return {
    x: clientX - rect.left,
    y: clientY - rect.top
  };
}

function handleMouseDown(e) {
  e.preventDefault();
  isDrawing = true;
  const pos = getCanvasPos(e);
  ctx.beginPath();
  ctx.moveTo(pos.x, pos.y);
  console.log('Mouse down:', pos.x, pos.y);
}

function handleMouseMove(e) {
  if (!isDrawing) return;
  e.preventDefault();
  const pos = getCanvasPos(e);
  ctx.lineTo(pos.x, pos.y);
  ctx.stroke();
}

function handleMouseUp(e) {
  if (!isDrawing) return;
  e.preventDefault();
  isDrawing = false;
  ctx.closePath();
  console.log('Mouse up - desenho finalizado');
}

function handleTouchStart(e) {
  e.preventDefault();
  isDrawing = true;
  const pos = getCanvasPos(e);
  ctx.beginPath();
  ctx.moveTo(pos.x, pos.y);
  console.log('Touch start:', pos.x, pos.y);
}

function handleTouchMove(e) {
  if (!isDrawing) return;
  e.preventDefault();
  const pos = getCanvasPos(e);
  ctx.lineTo(pos.x, pos.y);
  ctx.stroke();
}

function handleTouchEnd(e) {
  e.preventDefault();
  isDrawing = false;
  ctx.closePath();
  console.log('Touch end - desenho finalizado');
}

function limparAssinatura() {
  if (!ctx || !canvas) {
    console.error('Canvas nÃ£o inicializado');
    return;
  }
  
  ctx.fillStyle = '#ffffff';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  console.log('Canvas limpo');
}

function salvarAssinatura() {
  if (!currentEventoId) {
    showToast('âŒ Selecione um evento primeiro!', 'error');
    return;
  }
  
  if (!ctx || !canvas) {
    showToast('âŒ Erro no canvas!', 'error');
    return;
  }
  
  // Verificar se tem assinatura (checar pixels nÃ£o brancos)
  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  const pixels = imageData.data;
  let hasDrawing = false;
  
  // Verificar a cada 4 pixels (RGBA) se hÃ¡ algo desenhado
  for (let i = 3; i < pixels.length; i += 4) {
    if (pixels[i] > 0) { // Canal alpha
      // Verificar se nÃ£o Ã© branco
      const r = pixels[i-3];
      const g = pixels[i-2];
      const b = pixels[i-1];
      if (r < 255 || g < 255 || b < 255) {
        hasDrawing = true;
        break;
      }
    }
  }
  
  if (!hasDrawing) {
    showToast('âŒ FaÃ§a a assinatura primeiro!', 'error');
    return;
  }
  
  // Salvar assinatura
  try {
    assinaturas[currentEventoId] = canvas.toDataURL('image/png');
    salvarDados();
    
    // Atualizar preview no contrato
    const assinaturaDiv = document.getElementById('assinaturaContratado');
    if (assinaturaDiv) {
      assinaturaDiv.innerHTML = `<img src="${assinaturas[currentEventoId]}" style="max-height: 75px; max-width: 90%;">`;
    }
    
    showToast('âœ… Assinatura salva com sucesso!');
    console.log('Assinatura salva para evento:', currentEventoId);
  } catch (err) {
    console.error('Erro ao salvar assinatura:', err);
    showToast('âŒ Erro ao salvar assinatura!', 'error');
  }
}

// ==================== RECIBOS COM CONTROLE FINANCEIRO ====================

function carregarDadosRecibo() {
  const id = document.getElementById('recibo_evento').value;
  const resumoDiv = document.getElementById('resumoFinanceiro');
  
  if (!id) {
    resumoDiv.style.display = 'none';
    return;
  }
  
  const e = eventos.find(ev => ev.id === id);
  if (!e) return;
  
  const totalRecebido = calcularTotalRecebido(id);
  const saldo = e.valor - totalRecebido;
  const percentual = Math.round((totalRecebido / e.valor) * 100);
  
  // Atualizar resumo financeiro
  document.getElementById('finTotal').textContent = 'R$ ' + e.valor.toFixed(2);
  document.getElementById('finRecebido').textContent = 'R$ ' + totalRecebido.toFixed(2);
  document.getElementById('finSaldo').textContent = 'R$ ' + saldo.toFixed(2);
  document.getElementById('finProgresso').style.width = percentual + '%';
  document.getElementById('finProgresso').textContent = percentual + '%';
  
  let statusText = '';
  if (saldo <= 0) statusText = 'âœ… Evento Quitado';
  else if (totalRecebido > 0) statusText = 'ğŸ’µ Parcialmente Pago';
  else statusText = 'â³ Pendente';
  document.getElementById('finStatus').textContent = 'Status: ' + statusText;
  
  // Preencher campos
  document.getElementById('recibo_valor').value = saldo > 0 ? saldo.toFixed(2) : '';
  document.getElementById('recibo_referente').value = `ServiÃ§os de DJ - ${e.tipo || 'Evento'}`;
  document.getElementById('valorMaximo').textContent = 'R$ ' + saldo.toFixed(2);
  
  resumoDiv.style.display = 'block';
}

function validarValorRecibo() {
  const id = document.getElementById('recibo_evento').value;
  if (!id) return;
  
  const e = eventos.find(ev => ev.id === id);
  const valorInput = parseFloat(document.getElementById('recibo_valor').value) || 0;
  const totalRecebido = calcularTotalRecebido(id);
  const saldo = e.valor - totalRecebido;
  
  if (valorInput > saldo) {
    showToast('âš ï¸ Valor maior que o saldo devedor!', 'warning');
    document.getElementById('recibo_valor').value = saldo.toFixed(2);
  }
}

function gerarRecibo() {
  const id = document.getElementById('recibo_evento').value;
  const valor = parseFloat(document.getElementById('recibo_valor').value);
  const data = document.getElementById('recibo_data').value;
  const forma = document.getElementById('recibo_forma').value;
  const referente = document.getElementById('recibo_referente').value;
  
  if (!id || !valor || !data) {
    showToast('âŒ Preencha todos os campos!', 'error');
    return;
  }
  
  const e = eventos.find(ev => ev.id === id);
  const totalRecebido = calcularTotalRecebido(id) + valor;
  const saldo = e.valor - totalRecebido;
  
  const reciboHTML = `
    <div style="border: 2px solid #333; padding: 30px; max-width: 600px; margin: 0 auto; background: white; color: black; font-family: Arial, sans-serif;">
      <div style="text-align: center; margin-bottom: 20px;">
        <h2 style="margin: 0; color: black; font-size: 28px;">RECIBO</h2>
        <p style="margin: 5px 0; font-size: 24px; font-weight: bold; color: black;">NÂº ${Date.now().toString().slice(-6)}</p>
      </div>
      
      <p style="font-size: 16px; line-height: 1.6; margin-bottom: 20px; color: black; text-align: justify;">
        Eu, <strong>${config.nomeCompleto || config.nome}</strong>, ${config.cpf ? 'CPF: ' + config.cpf : ''}, 
        declaro que RECEBI de <strong>${e.nome}</strong>${e.cpf ? ', CPF: ' + e.cpf : ''}, 
        a importÃ¢ncia de <strong>R$ ${valor.toFixed(2)}</strong> (${valorPorExtenso(valor)}), 
        referente a ${referente || 'serviÃ§os de DJ'}.
      </p>
      
      <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <p style="font-size: 14px; margin: 5px 0; color: black;">
          <strong>Evento:</strong> ${e.tipo || 'Evento'}<br>
          <strong>Data do evento:</strong> ${new Date(e.data).toLocaleDateString('pt-BR')}<br>
          <strong>Forma de pagamento:</strong> ${forma}<br>
          <strong>Data do pagamento:</strong> ${new Date(data).toLocaleDateString('pt-BR')}
        </p>
      </div>
      
      <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #4caf50;">
        <p style="font-size: 14px; margin: 5px 0; color: black;">
          <strong>Resumo Financeiro:</strong><br>
          Valor Total: R$ ${e.valor.toFixed(2)}<br>
          Total Recebido: R$ ${totalRecebido.toFixed(2)}<br>
          <strong>Saldo Devedor: R$ ${saldo.toFixed(2)}</strong>
        </p>
      </div>
      
      <div style="margin-top: 40px; text-align: center;">
        <div style="border-top: 1px solid #333; display: inline-block; padding-top: 10px; min-width: 300px;">
          <strong style="color: black; font-size: 16px;">${config.nomeCompleto || config.nome}</strong><br>
          <small style="color: #666;">${config.cpf || ''}</small>
        </div>
      </div>
      
      <div style="margin-top: 30px; text-align: center; font-size: 11px; color: #666; border-top: 1px solid #ddd; padding-top: 15px;">
        ${config.rua ? config.rua + ', ' : ''}${config.numero || ''}<br>
        ${config.bairro ? config.bairro + ' - ' : ''}${config.cidade || ''}${config.estado ? '/' + config.estado : ''}<br>
        ${config.telefone}${config.email ? ' | ' + config.email : ''}<br>
        ${config.instagram ? config.instagram : ''}
      </div>
    </div>
  `;
  
  document.getElementById('previewRecibo').innerHTML = reciboHTML;
  document.getElementById('previewRecibo').style.display = 'block';
}

function salvarRecibo() {
  const id = document.getElementById('recibo_evento').value;
  const valor = parseFloat(document.getElementById('recibo_valor').value);
  const data = document.getElementById('recibo_data').value;
  const forma = document.getElementById('recibo_forma').value;
  const referente = document.getElementById('recibo_referente').value;
  
  if (!id || !valor || !data) {
    showToast('âŒ Preencha todos os campos!', 'error');
    return;
  }
  
  const e = eventos.find(ev => ev.id === id);
  const totalRecebido = calcularTotalRecebido(id);
  
  if (totalRecebido + valor > e.valor) {
    showToast('âŒ Valor excede o total do evento!', 'error');
    return;
  }
  
  const recibo = {
    id: Date.now().toString(),
    eventoId: id,
    cliente: e.nome,
    valor: valor,
    data: data,
    forma: forma,
    referente: referente,
    dataEmissao: new Date().toISOString()
  };
  
  recibos.push(recibo);
  salvarDados();
  renderizarRecibos();
  atualizarDashboard();
  renderizarCaixa();
  
  const novoTotal = totalRecebido + valor;
  const saldo = e.valor - novoTotal;
  
  showToast(`âœ… Recibo salvo! ${saldo <= 0 ? 'Evento quitado!' : 'Saldo: R$ ' + saldo.toFixed(2)}`);
  
  // Limpar formulÃ¡rio
  document.getElementById('recibo_evento').value = '';
  document.getElementById('recibo_valor').value = '';
  document.getElementById('recibo_referente').value = '';
  document.getElementById('previewRecibo').style.display = 'none';
  document.getElementById('resumoFinanceiro').style.display = 'none';
}

function emitirRecibo(id) {
  showTab('recibo');
  setTimeout(() => {
    document.getElementById('recibo_evento').value = id;
    carregarDadosRecibo();
  }, 100);
}

function renderizarRecibos() {
  const container = document.getElementById('listaRecibos');
  
  if (recibos.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ“­</div>
        <p>Nenhum recibo emitido</p>
      </div>
    `;
    return;
  }
  
  const sorted = [...recibos].sort((a, b) => new Date(b.dataEmissao) - new Date(a.dataEmissao));
  
  container.innerHTML = sorted.map(r => {
    const e = eventos.find(ev => ev.id === r.eventoId);
    const totalEvento = e ? e.valor : 0;
    const totalRecebido = calcularTotalRecebido(r.eventoId);
    const status = totalRecebido >= totalEvento ? 'âœ…' : 'ğŸ’µ';
    
    return `
      <div class="list-item">
        <div class="list-item-header">
          <div>
            <div class="list-item-title">${status} Recibo NÂº ${r.id.slice(-6)}</div>
            <div class="list-item-meta">
              Cliente: ${r.cliente}<br>
              Data: ${new Date(r.data).toLocaleDateString('pt-BR')} â€¢ ${r.forma}
            </div>
          </div>
          <span class="badge badge-success">R$ ${r.valor.toFixed(2)}</span>
        </div>
        <div class="list-item-actions">
          <button class="btn btn-sm btn-primary" onclick="verRecibo('${r.id}')">ğŸ‘ï¸ Visualizar</button>
          <button class="btn btn-sm btn-secondary" onclick="compartilharRecibo('${r.id}')">ğŸ“¤ Compartilhar</button>
        </div>
      </div>
    `;
  }).join('');
}

function verRecibo(id) {
  const r = recibos.find(rec => rec.id === id);
  if (!r) return;
  
  const e = eventos.find(ev => ev.id === r.eventoId);
  const totalRecebido = calcularTotalRecebido(r.eventoId);
  const saldo = e.valor - totalRecebido;
  
  const html = `
    <div style="border: 2px solid #333; padding: 30px; max-width: 600px; margin: 0 auto; background: white; color: black; font-family: Arial, sans-serif;">
      <div style="text-align: center; margin-bottom: 20px;">
        <h2 style="margin: 0; color: black; font-size: 28px;">RECIBO</h2>
        <p style="margin: 5px 0; font-size: 24px; font-weight: bold; color: black;">NÂº ${r.id.slice(-6)}</p>
      </div>
      
      <p style="font-size: 16px; line-height: 1.6; margin-bottom: 20px; color: black;">
        Eu, <strong>${config.nomeCompleto || config.nome}</strong>, ${config.cpf ? 'CPF: ' + config.cpf : ''}, 
        declaro que RECEBI de <strong>${r.cliente}</strong>, a importÃ¢ncia de 
        <strong>R$ ${r.valor.toFixed(2)}</strong> (${valorPorExtenso(r.valor)}), 
        referente a ${r.referente || 'serviÃ§os de DJ'}.
      </p>
      
      <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
        <p style="font-size: 14px; margin: 5px 0; color: black;">
          <strong>Forma de pagamento:</strong> ${r.forma}<br>
          <strong>Data do pagamento:</strong> ${new Date(r.data).toLocaleDateString('pt-BR')}
        </p>
      </div>
      
      ${e ? `
      <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #4caf50;">
        <p style="font-size: 14px; margin: 5px 0; color: black;">
          <strong>Resumo do Evento:</strong><br>
          Valor Total: R$ ${e.valor.toFixed(2)}<br>
          Total Recebido: R$ ${totalRecebido.toFixed(2)}<br>
          <strong>Saldo: R$ ${saldo.toFixed(2)}</strong>
        </p>
      </div>
      ` : ''}
      
      <div style="margin-top: 40px; text-align: center;">
        <div style="border-top: 1px solid #333; display: inline-block; padding-top: 10px; min-width: 300px;">
          <strong style="color: black;">${config.nomeCompleto || config.nome}</strong><br>
          <small style="color: #666;">${config.cpf || ''}</small>
        </div>
      </div>
    </div>
  `;
  
  const w = window.open('', '_blank');
  w.document.write(html);
  w.document.close();
  w.print();
}

function compartilharRecibo(id) {
  const r = recibos.find(rec => rec.id === id);
  if (!r) return;
  
  const e = eventos.find(ev => ev.id === r.eventoId);
  const totalRecebido = calcularTotalRecebido(r.eventoId);
  const saldo = e ? e.valor - totalRecebido : 0;
  
  const texto = `*Recibo NÂº ${r.id.slice(-6)} - ${config.nome}*\n\n` +
    `Cliente: ${r.cliente}\n` +
    `Valor: R$ ${r.valor.toFixed(2)}\n` +
    `Data: ${new Date(r.data).toLocaleDateString('pt-BR')}\n` +
    `Forma: ${r.forma}\n\n` +
    `${e ? `*Resumo do Evento:*\nTotal: R$ ${e.valor.toFixed(2)}\nRecebido: R$ ${totalRecebido.toFixed(2)}\nSaldo: R$ ${saldo.toFixed(2)}` : ''}`;
  
  if (navigator.share) {
    navigator.share({
      title: 'Recibo de Pagamento',
      text: texto
    });
  } else {
    navigator.clipboard.writeText(texto);
    showToast('ğŸ“‹ Recibo copiado!');
  }
}

// ==================== UTILITÃRIOS ====================

function valorPorExtenso(valor) {
  const unidades = ['zero', 'um', 'dois', 'trÃªs', 'quatro', 'cinco', 'seis', 'sete', 'oito', 'nove'];
  const dezenas = ['dez', 'onze', 'doze', 'treze', 'quatorze', 'quinze', 'dezesseis', 'dezessete', 'dezoito', 'dezenove'];
  const dezenas2 = ['vinte', 'trinta', 'quarenta', 'cinquenta', 'sessenta', 'setenta', 'oitenta', 'noventa'];
  const centenas = ['cem', 'duzentos', 'trezentos', 'quatrocentos', 'quinhentos', 'seiscentos', 'setecentos', 'oitocentos', 'novecentos'];
  
  const inteiro = Math.floor(valor);
  const centavos = Math.round((valor - inteiro) * 100);
  
  if (inteiro === 0 && centavos === 0) return 'zero reais';
  
  let extenso = '';
  
  if (inteiro >= 1000) {
    const milhares = Math.floor(inteiro / 1000);
    if (milhares === 1) extenso += 'mil ';
    else if (milhares < 10) extenso += unidades[milhares] + ' mil ';
    else if (milhares < 20) extenso += dezenas[milhares - 10] + ' mil ';
    else if (milhares < 100) {
      const d = Math.floor(milhares / 10);
      const u = milhares % 10;
      extenso += dezenas2[d - 2] + (u > 0 ? ' e ' + unidades[u] : '') + ' mil ';
    }
  }
  
  const resto = inteiro % 1000;
  if (resto >= 100) {
    const c = Math.floor(resto / 100);
    const restoCentena = resto % 100;
    if (extenso && restoCentena === 0) extenso += 'e ';
    extenso += centenas[c - 1] + (restoCentena > 0 ? ' e ' : ' ');
  }
  
  const du = resto % 100;
  if (du > 0) {
    if (extenso && !extenso.endsWith('e ')) extenso += 'e ';
    if (du < 10) extenso += unidades[du];
    else if (du < 20) extenso += dezenas[du - 10];
    else {
      const d = Math.floor(du / 10);
      const u = du % 10;
      extenso += dezenas2[d - 2] + (u > 0 ? ' e ' + unidades[u] : '');
    }
  }
  
  extenso += inteiro === 1 ? ' real' : ' reais';
  
  if (centavos > 0) {
    extenso += ' e ';
    if (centavos < 10) extenso += unidades[centavos];
    else if (centavos < 20) extenso += dezenas[centavos - 10];
    else {
      const d = Math.floor(centavos / 10);
      const u = centavos % 10;
      extenso += dezenas2[d - 2] + (u > 0 ? ' e ' + unidades[u] : '');
    }
    extenso += centavos === 1 ? ' centavo' : ' centavos';
  }
  
  return extenso;
}

function showToast(message, type = 'success') {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.className = 'toast show ' + type;
  
  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000);
}

// ==================== PERSISTÃŠNCIA ====================

function salvarDados() {
  localStorage.setItem('djpro_config', JSON.stringify(config));
  localStorage.setItem('djpro_eventos', JSON.stringify(eventos));
  localStorage.setItem('djpro_recibos', JSON.stringify(recibos));
  localStorage.setItem('djpro_assinaturas', JSON.stringify(assinaturas));
}

function carregarDados() {
  const savedConfig = localStorage.getItem('djpro_config');
  const savedEventos = localStorage.getItem('djpro_eventos');
  const savedRecibos = localStorage.getItem('djpro_recibos');
  const savedAssinaturas = localStorage.getItem('djpro_assinaturas');
  
  if (savedConfig) {
    config = { ...config, ...JSON.parse(savedConfig) };
    document.body.setAttribute('data-color', config.cor);
    if (config.temaEscuro) {
      document.body.setAttribute('data-theme', 'dark');
    }
  }
  
  if (savedEventos) eventos = JSON.parse(savedEventos);
  if (savedRecibos) recibos = JSON.parse(savedRecibos);
  if (savedAssinaturas) assinaturas = JSON.parse(savedAssinaturas);
}

function exportarDados() {
  const dados = {
    config,
    eventos,
    recibos,
    assinaturas,
    exportado: new Date().toISOString()
  };
  
  const blob = new Blob([JSON.stringify(dados, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `djpro_backup_${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  
  showToast('ğŸ’¾ Backup exportado!');
}

function importarDados(input) {
  const file = input.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const dados = JSON.parse(e.target.result);
      
      if (confirm('Isso substituirÃ¡ todos os dados atuais. Continuar?')) {
        config = { ...config, ...dados.config };
        eventos = dados.eventos || [];
        recibos = dados.recibos || [];
        assinaturas = dados.assinaturas || {};
        
        salvarDados();
        location.reload();
      }
    } catch (err) {
      showToast('âŒ Arquivo invÃ¡lido!', 'error');
    }
  };
  reader.readAsText(file);
}

function limparTodosDados() {
  if (!confirm('âš ï¸ ATENÃ‡ÃƒO: Isso apagarÃ¡ TODOS os dados permanentemente!\n\nTem certeza?')) return;
  if (!confirm('Ãšltima chance! Deseja mesmo apagar tudo?')) return;
  
  localStorage.removeItem('djpro_config');
  localStorage.removeItem('djpro_eventos');
  localStorage.removeItem('djpro_recibos');
  localStorage.removeItem('djpro_assinaturas');
  
  location.reload();
}

// Service Worker para PWA
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('data:text/javascript,' + encodeURIComponent(`
    self.addEventListener('install', e => {
      e.waitUntil(self.skipWaiting());
    });
    self.addEventListener('activate', e => {
      e.waitUntil(self.clients.claim());
    });
    self.addEventListener('fetch', e => {
      e.respondWith(fetch(e.request).catch(() => {
        return new Response('Offline');
      }));
    });
  `)).catch(() => console.log('SW nÃ£o registrado'));
}
</script>

</body>
</html>
