
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<meta name="theme-color" content="#0b76d1"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="apple-mobile-web-app-title" content="DJ Pro"/>
<meta name="description" content="Sistema profissional de gest√£o para DJs"/>
<title>DJ Pro - Sistema de Gest√£o</title>

<link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%230b76d1' width='100' height='100' rx='20'/%3E%3Ctext x='50' y='65' font-size='50' text-anchor='middle'%3Eüéß%3C/text%3E%3C/svg%3E"/>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%230b76d1' width='100' height='100' rx='20'/%3E%3Ctext x='50' y='65' font-size='50' text-anchor='middle'%3Eüéß%3C/text%3E%3C/svg%3E"/>

<style>
  :root {
    --primary: #0b76d1;
    --primary-dark: #0056b3;
    --secondary: #6c757d;
    --success: #28a745;
    --danger: #dc3545;
    --warning: #ffc107;
    --info: #17a2b8;
    --bg: #f8f9fa;
    --card: #ffffff;
    --text: #212529;
    --text-muted: #6c757d;
    --border: #dee2e6;
    --shadow: 0 4px 20px rgba(0,0,0,0.08);
    --radius: 16px;
    --header-height: 70px;
    --bottom-nav-height: 70px;
  }

  [data-theme="dark"] {
    --bg: #0f1419;
    --card: #1a1d29;
    --text: #e4e6eb;
    --text-muted: #b0b3b8;
    --border: #3e4042;
    --shadow: 0 4px 20px rgba(0,0,0,0.4);
  }

  [data-color="purple"] { --primary: #6f42c1; --primary-dark: #5a32a3; }
  [data-color="green"] { --primary: #28a745; --primary-dark: #1e7e34; }
  [data-color="red"] { --primary: #dc3545; --primary-dark: #bd2130; }
  [data-color="orange"] { --primary: #fd7e14; --primary-dark: #e56b0a; }
  [data-color="pink"] { --primary: #e83e8c; --primary-dark: #d91a72; }
  [data-color="black"] { --primary: #343a40; --primary-dark: #1d2124; }

  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  html { scroll-behavior: smooth; }
  
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    padding-bottom: calc(var(--bottom-nav-height) + 20px);
    min-height: 100vh;
  }

  .app-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: var(--header-height);
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    z-index: 1000;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  }
  
  .app-header h1 {
    font-size: 22px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .header-actions {
    display: flex;
    gap: 10px;
  }
  
  .header-btn {
    width: 44px;
    height: 44px;
    border-radius: 12px;
    border: none;
    background: rgba(255,255,255,0.2);
    color: white;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    backdrop-filter: blur(10px);
  }
  
  .header-btn:hover { background: rgba(255,255,255,0.3); transform: scale(1.05); }

  .main-content {
    margin-top: var(--header-height);
    padding: 20px;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
  }

  .card {
    background: var(--card);
    border-radius: var(--radius);
    padding: 24px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
    animation: slideUp 0.4s ease;
  }
  
  @keyframes slideUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .card-title {
    font-size: 20px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .form-group {
    margin-bottom: 20px;
  }
  
  .form-label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: var(--text-muted);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .form-control {
    width: 100%;
    padding: 14px 18px;
    border: 2px solid var(--border);
    border-radius: 12px;
    background: var(--card);
    color: var(--text);
    font-size: 16px;
    transition: all 0.2s;
  }
  
  .form-control:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(11, 118, 209, 0.1);
    outline: none;
  }

  .form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
  }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 14px 24px;
    border-radius: 12px;
    border: none;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    background: var(--primary);
    color: white;
    text-decoration: none;
  }
  
  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(11, 118, 209, 0.3);
  }
  
  .btn-success { background: var(--success); }
  .btn-danger { background: var(--danger); }
  .btn-warning { background: var(--warning); color: #000; }
  .btn-secondary { background: var(--secondary); }
  .btn-outline {
    background: transparent;
    border: 2px solid var(--primary);
    color: var(--primary);
  }
  .btn-outline:hover { background: var(--primary); color: white; }
  .btn-lg { padding: 18px 32px; font-size: 17px; width: 100%; }
  .btn-sm { padding: 10px 16px; font-size: 13px; }

  .bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: var(--bottom-nav-height);
    background: var(--card);
    border-top: 1px solid var(--border);
    display: flex;
    justify-content: space-around;
    align-items: center;
    z-index: 999;
    padding-bottom: env(safe-area-inset-bottom);
  }
  
  .nav-item {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
    padding: 10px;
    color: var(--text-muted);
    text-decoration: none;
    font-size: 12px;
    font-weight: 500;
    transition: all 0.2s;
    cursor: pointer;
    background: none;
    border: none;
  }
  
  .nav-item .icon { font-size: 24px; transition: transform 0.2s; }
  .nav-item.active { color: var(--primary); }
  .nav-item.active .icon { transform: translateY(-4px); }

  .section { display: none; animation: fadeIn 0.3s ease; }
  .section.active { display: block; }
  
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-bottom: 20px;
  }
  
  .stat-card {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    padding: 20px;
    border-radius: var(--radius);
    text-align: center;
    cursor: pointer;
    transition: transform 0.2s;
  }
  
  .stat-card:hover { transform: translateY(-5px); }
  .stat-value { font-size: 28px; font-weight: 800; margin-bottom: 5px; }
  .stat-label { font-size: 12px; opacity: 0.9; text-transform: uppercase; letter-spacing: 1px; }

  .list-item {
    background: var(--bg);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 12px;
    border-left: 4px solid var(--primary);
    transition: all 0.2s;
  }
  
  .list-item:hover { transform: translateX(5px); box-shadow: var(--shadow); }
  
  .list-item-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 10px;
  }
  
  .list-item-title { font-size: 17px; font-weight: 700; color: var(--text); }
  .list-item-meta { font-size: 14px; color: var(--text-muted); margin-top: 5px; }
  .list-item-actions { display: flex; gap: 8px; margin-top: 15px; flex-wrap: wrap; }

  .badge {
    display: inline-flex;
    align-items: center;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
  }
  
  .badge-success { background: #d4edda; color: #155724; }
  .badge-warning { background: #fff3cd; color: #856404; }
  .badge-danger { background: #f8d7da; color: #721c24; }
  .badge-info { background: #d1ecf1; color: #0c5460; }

  /* √ÅREA DO CONTRATO - Apenas esta parte aparece na impress√£o */
  #contractPrintArea {
    background: white;
    color: black;
    padding: 40px;
    font-family: 'Times New Roman', Times, serif;
    line-height: 1.8;
    font-size: 14px;
    max-width: 800px;
    margin: 0 auto;
    display: none;
  }

  #contractPrintArea h2 {
    color: black;
    text-align: center;
    margin-bottom: 30px;
    font-size: 22px;
    font-weight: bold;
    text-transform: uppercase;
  }

  #contractPrintArea p {
    margin-bottom: 15px;
    text-align: justify;
    color: black;
  }

  #contractPrintArea strong {
    color: black;
  }

  #contractPrintArea .signature-area {
    margin-top: 60px;
    display: flex;
    justify-content: space-between;
    gap: 40px;
  }

  #contractPrintArea .signature-box {
    text-align: center;
    flex: 1;
  }

  #contractPrintArea .signature-line {
    border-top: 1px solid #333;
    height: 80px;
    margin-bottom: 10px;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding-bottom: 5px;
  }

  #contractPrintArea .signature-img {
    max-height: 70px;
    max-width: 100%;
  }

  /* Controles do contrato - N√ÉO aparecem na impress√£o */
  .contract-controls {
    background: var(--card);
    border-radius: var(--radius);
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
  }

  .signature-pad-container {
    background: var(--card);
    border-radius: var(--radius);
    padding: 20px;
    margin-top: 20px;
    box-shadow: var(--shadow);
  }

  .signature-pad {
    background: white;
    border: 2px solid #333;
    border-radius: 8px;
    width: 100%;
    height: 250px;
    touch-action: none;
    cursor: crosshair;
    display: block;
  }

  /* CSS CR√çTICO PARA IMPRESS√ÉO - Esconde TUDO exceto o contrato */
  @media print {
    * {
      visibility: hidden !important;
    }
    
    html, body {
      background: white !important;
      padding: 0 !important;
      margin: 0 !important;
    }
    
    #contractPrintArea,
    #contractPrintArea * {
      visibility: visible !important;
      color: black !important;
      background: white !important;
      box-shadow: none !important;
      border: none !important;
    }
    
    #contractPrintArea {
      position: absolute !important;
      left: 0 !important;
      top: 0 !important;
      width: 100% !important;
      max-width: 100% !important;
      padding: 20px !important;
      margin: 0 !important;
      display: block !important;
    }
    
    #contractPrintArea h2 {
      font-size: 18px !important;
      margin-bottom: 20px !important;
    }
    
    #contractPrintArea p {
      font-size: 12px !important;
      line-height: 1.6 !important;
      margin-bottom: 10px !important;
    }
    
    #contractPrintArea .signature-area {
      margin-top: 40px !important;
    }
    
    .app-header, 
    .bottom-nav, 
    .contract-controls,
    .signature-pad-container,
    .btn,
    .card:not(#contractPrintArea),
    .section:not(#contrato),
    #contrato > *:not(#contractPrintArea) {
      display: none !important;
      visibility: hidden !important;
    }
  }

  .modal-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.6);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    padding: 20px;
    backdrop-filter: blur(5px);
  }
  
  .modal-overlay.active { display: flex; }
  
  .modal-content {
    background: var(--card);
    border-radius: var(--radius);
    width: 100%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    animation: modalSlide 0.3s ease;
  }
  
  @keyframes modalSlide {
    from { transform: translateY(50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  
  .modal-header {
    padding: 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .modal-header h3 { font-size: 20px; font-weight: 700; color: var(--primary); }
  
  .modal-close {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: none;
    background: var(--bg);
    color: var(--text);
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .modal-body { padding: 24px; }
  .modal-footer {
    padding: 20px 24px;
    border-top: 1px solid var(--border);
    display: flex;
    gap: 10px;
    justify-content: flex-end;
  }

  .login-screen {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    z-index: 3000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px;
  }
  
  .login-logo { font-size: 80px; margin-bottom: 20px; }
  .login-title { color: white; font-size: 28px; font-weight: 700; margin-bottom: 10px; }
  .login-subtitle { color: rgba(255,255,255,0.8); margin-bottom: 40px; text-align: center; }
  
  .pin-display { display: flex; gap: 15px; margin-bottom: 30px; }
  
  .pin-dot {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255,255,255,0.3);
    transition: all 0.2s;
  }
  
  .pin-dot.filled { background: white; transform: scale(1.2); }
  
  .pin-pad {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    width: 100%;
    max-width: 300px;
  }
  
  .pin-btn {
    aspect-ratio: 1;
    border-radius: 50%;
    border: 2px solid rgba(255,255,255,0.3);
    background: transparent;
    color: white;
    font-size: 24px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .pin-btn:hover { background: rgba(255,255,255,0.1); border-color: white; }

  .profile-header {
    text-align: center;
    padding: 30px;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    border-radius: var(--radius);
    margin-bottom: 20px;
  }
  
  .profile-avatar {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 50px;
    margin: 0 auto 15px;
    border: 4px solid rgba(255,255,255,0.3);
  }
  
  .profile-name { font-size: 24px; font-weight: 700; margin-bottom: 5px; }
  .profile-role { opacity: 0.9; font-size: 14px; }

  .color-picker { display: flex; gap: 10px; flex-wrap: wrap; }
  
  .color-option {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    cursor: pointer;
    border: 3px solid transparent;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
  }
  
  .color-option:hover { transform: scale(1.1); }
  .color-option.selected { border-color: var(--text); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }

  .toast {
    position: fixed;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--success);
    color: white;
    padding: 16px 32px;
    border-radius: 50px;
    font-weight: 600;
    z-index: 4000;
    opacity: 0;
    transition: all 0.3s;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  }
  
  .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
  .toast.error { background: var(--danger); }
  .toast.warning { background: var(--warning); color: #000; }

  .empty-state { text-align: center; padding: 60px 20px; color: var(--text-muted); }
  .empty-state-icon { font-size: 64px; margin-bottom: 20px; opacity: 0.5; }

  .section-group {
    background: var(--bg);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    border: 1px solid var(--border);
  }

  .section-group-title {
    font-size: 16px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .progress-bar {
    width: 100%;
    height: 20px;
    background: var(--border);
    border-radius: 10px;
    overflow: hidden;
    margin-top: 10px;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--success), var(--primary));
    transition: width 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 12px;
    font-weight: 600;
  }

  .payment-history {
    background: var(--bg);
    border-radius: 8px;
    padding: 15px;
    margin-top: 15px;
  }

  .payment-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid var(--border);
  }

  .payment-item:last-child { border-bottom: none; }

  .financial-summary {
    background: linear-gradient(135deg, var(--success) 0%, var(--primary) 100%);
    color: white;
    padding: 20px;
    border-radius: var(--radius);
    margin-bottom: 20px;
  }

  .financial-summary h3 {
    font-size: 16px;
    margin-bottom: 15px;
    opacity: 0.9;
  }

  .financial-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
  }

  .financial-item {
    background: rgba(255,255,255,0.2);
    padding: 15px;
    border-radius: 8px;
    text-align: center;
  }

  .financial-value {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 5px;
  }

  .financial-label {
    font-size: 12px;
    opacity: 0.9;
    text-transform: uppercase;
  }

  @media (min-width: 1024px) {
    .main-content { max-width: 1000px; }
    .bottom-nav { display: none; }
    body { padding-bottom: 20px; }
  }

  @media (max-width: 480px) {
    :root { --radius: 12px; }
    .card { padding: 20px; }
    .stat-value { font-size: 24px; }
    .btn { padding: 12px 20px; }
    .form-row { grid-template-columns: 1fr; }
    #contractPrintArea { padding: 20px; }
  }

  @supports (padding-top: env(safe-area-inset-top)) {
    .app-header {
      padding-top: env(safe-area-inset-top);
      height: calc(var(--header-height) + env(safe-area-inset-top));
    }
    .main-content { margin-top: calc(var(--header-height) + env(safe-area-inset-top)); }
  }
</style>
</head>
<body>

<!-- TELA DE LOGIN/PIN -->
<div id="loginScreen" class="login-screen" style="display: none;">
  <div class="login-logo">üéß</div>
  <div class="login-title" id="loginTitle">DJ Pro</div>
  <div class="login-subtitle" id="loginSubtitle">Digite seu PIN para acessar</div>
  
  <div class="pin-display" id="pinDisplay">
    <div class="pin-dot"></div>
    <div class="pin-dot"></div>
    <div class="pin-dot"></div>
    <div class="pin-dot"></div>
  </div>
  
  <div class="pin-pad">
    <button class="pin-btn" onclick="enterPin(1)">1</button>
    <button class="pin-btn" onclick="enterPin(2)">2</button>
    <button class="pin-btn" onclick="enterPin(3)">3</button>
    <button class="pin-btn" onclick="enterPin(4)">4</button>
    <button class="pin-btn" onclick="enterPin(5)">5</button>
    <button class="pin-btn" onclick="enterPin(6)">6</button>
    <button class="pin-btn" onclick="enterPin(7)">7</button>
    <button class="pin-btn" onclick="enterPin(8)">8</button>
    <button class="pin-btn" onclick="enterPin(9)">9</button>
    <button class="pin-btn" onclick="clearPin()">‚å´</button>
    <button class="pin-btn" onclick="enterPin(0)">0</button>
    <button class="pin-btn" onclick="skipLogin()">‚úì</button>
  </div>
</div>

<!-- HEADER -->
<header class="app-header">
  <h1>üéß <span id="appTitle">DJ Pro</span></h1>
  <div class="header-actions">
    <button class="header-btn" onclick="showModal('config')" title="Configura√ß√µes">‚öôÔ∏è</button>
    <button class="header-btn" onclick="toggleTheme()" title="Tema">üåì</button>
  </div>
</header>

<!-- CONTE√öDO PRINCIPAL -->
<main class="main-content">

<!-- DASHBOARD -->
<section id="dashboard" class="section active">
  <div class="stats-grid">
    <div class="stat-card" onclick="showTab('caixa')" style="cursor: pointer;">
      <div class="stat-value" id="dashTotal">R$ 0</div>
      <div class="stat-label">üí∞ Caixa</div>
    </div>
    <div class="stat-card" style="background: linear-gradient(135deg, var(--info) 0%, #0dcaf0 100%);" onclick="showTab('eventos')">
      <div class="stat-value" id="dashEventos">0</div>
      <div class="stat-label">Eventos</div>
    </div>
    <div class="stat-card" style="background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);" onclick="showTab('recibos')">
      <div class="stat-value" id="dashRecibos">0</div>
      <div class="stat-label">Recibos</div>
    </div>
    <div class="stat-card" style="background: linear-gradient(135deg, var(--warning) 0%, #ff6b6b 100%);" onclick="showTab('clientes')">
      <div class="stat-value" id="dashClientes">0</div>
      <div class="stat-label">Clientes</div>
    </div>
  </div>

  <div class="financial-summary">
    <h3>üìä Resumo Financeiro</h3>
    <div class="financial-grid">
      <div class="financial-item">
        <div class="financial-value" id="totalContratado">R$ 0</div>
        <div class="financial-label">Total Contratado</div>
      </div>
      <div class="financial-item">
        <div class="financial-value" id="totalRecebido">R$ 0</div>
        <div class="financial-label">Total Recebido</div>
      </div>
      <div class="financial-item">
        <div class="financial-value" id="totalPendente">R$ 0</div>
        <div class="financial-label">Total Pendente</div>
      </div>
      <div class="financial-item">
        <div class="financial-value" id="mediaPorEvento">R$ 0</div>
        <div class="financial-label">M√©dia por Evento</div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">üìà √öltimos Eventos</div>
    <div id="ultimosEventos">
      <div class="empty-state">
        <div class="empty-state-icon">üìÖ</div>
        <p>Nenhum evento cadastrado</p>
      </div>
    </div>
  </div>
</section>

<!-- CLIENTES -->
<section id="clientes" class="section">
  <div class="card">
    <div class="card-title">üë• Novo Cliente</div>
    <form id="formCliente" onsubmit="salvarCliente(event)">
      <div class="form-row">
        <div class="form-group" style="flex: 2;">
          <label class="form-label">Nome Completo</label>
          <input type="text" class="form-control" id="clienteNome" required placeholder="Nome do cliente">
        </div>
        <div class="form-group">
          <label class="form-label">CPF/CNPJ</label>
          <input type="text" class="form-control" id="clienteDocumento" placeholder="000.000.000-00">
        </div>
      </div>
      
      <div class="section-group-title">üìç Endere√ßo Completo</div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">CEP</label>
          <input type="text" class="form-control" id="clienteCep" placeholder="00000-000" onblur="buscarCep()">
        </div>
        <div class="form-group" style="flex: 2;">
          <label class="form-label">Rua/Avenida</label>
          <input type="text" class="form-control" id="clienteRua" placeholder="Nome da rua">
        </div>
        <div class="form-group">
          <label class="form-label">N√∫mero</label>
          <input type="text" class="form-control" id="clienteNumero" placeholder="123">
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Complemento</label>
          <input type="text" class="form-control" id="clienteComplemento" placeholder="Apto, Sala, etc">
        </div>
        <div class="form-group">
          <label class="form-label">Bairro</label>
          <input type="text" class="form-control" id="clienteBairro" placeholder="Bairro">
        </div>
        <div class="form-group">
          <label class="form-label">Cidade</label>
          <input type="text" class="form-control" id="clienteCidade" placeholder="Cidade">
        </div>
        <div class="form-group">
          <label class="form-label">Estado</label>
          <input type="text" class="form-control" id="clienteEstado" placeholder="UF" maxlength="2">
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Telefone</label>
          <input type="tel" class="form-control" id="clienteTelefone" placeholder="(00) 00000-0000">
        </div>
        <div class="form-group">
          <label class="form-label">E-mail</label>
          <input type="email" class="form-control" id="clienteEmail" placeholder="email@exemplo.com">
        </div>
      </div>
      
      <button type="submit" class="btn btn-lg">üíæ Salvar Cliente</button>
    </form>
  </div>

  <div class="card">
    <div class="card-title">üìã Lista de Clientes</div>
    <div id="listaClientes">
      <div class="empty-state">
        <div class="empty-state-icon">üë§</div>
        <p>Nenhum cliente cadastrado</p>
      </div>
    </div>
  </div>
</section>

<!-- EVENTOS -->
<section id="eventos" class="section">
  <div class="card">
    <div class="card-title">üéâ Novo Evento</div>
    <form id="formEvento" onsubmit="salvarEvento(event)">
      <div class="form-group">
        <label class="form-label">Cliente</label>
        <select class="form-control" id="eventoCliente" required>
          <option value="">Selecione um cliente...</option>
        </select>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Tipo de Evento</label>
          <select class="form-control" id="eventoTipo" required>
            <option value="Casamento">Casamento</option>
            <option value="Anivers√°rio">Anivers√°rio</option>
            <option value="Corporativo">Corporativo</option>
            <option value="Debutante">Debutante</option>
            <option value="Formatura">Formatura</option>
            <option value="Outro">Outro</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Data do Evento</label>
          <input type="date" class="form-control" id="eventoData" required>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Hor√°rio In√≠cio</label>
          <input type="time" class="form-control" id="eventoHoraInicio" required>
        </div>
        <div class="form-group">
          <label class="form-label">Hor√°rio T√©rmino</label>
          <input type="time" class="form-control" id="eventoHoraFim" required>
        </div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Local do Evento</label>
        <input type="text" class="form-control" id="eventoLocal" required placeholder="Nome do local/endere√ßo">
      </div>
      
      <div class="section-group-title">üí∞ Valores e Pagamento</div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Valor Total do Contrato (R$)</label>
          <input type="number" step="0.01" class="form-control" id="eventoValorTotal" required placeholder="0,00" onchange="calcularSaldo()">
        </div>
        <div class="form-group">
          <label class="form-label">Sinal/Entrada (R$)</label>
          <input type="number" step="0.01" class="form-control" id="eventoValorEntrada" placeholder="0,00" onchange="calcularSaldo()">
        </div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Saldo Restante</label>
        <input type="text" class="form-control" id="eventoSaldo" readonly style="background: var(--bg); font-weight: bold; color: var(--primary);">
      </div>
      
      <div class="form-group">
        <label class="form-label">Observa√ß√µes</label>
        <textarea class="form-control" id="eventoObservacoes" rows="3" placeholder="Detalhes adicionais do evento..."></textarea>
      </div>
      
      <button type="submit" class="btn btn-lg">üíæ Salvar Evento</button>
    </form>
  </div>

  <div class="card">
    <div class="card-title">üìã Meus Eventos</div>
    <div id="listaEventos">
      <div class="empty-state">
        <div class="empty-state-icon">üìÖ</div>
        <p>Nenhum evento cadastrado</p>
      </div>
    </div>
  </div>
</section>

<!-- CONTRATOS -->
<section id="contratos" class="section">
  <div class="contract-controls">
    <div class="card-title">üìÑ Gerar Contrato</div>
    <div class="form-group">
      <label class="form-label">Selecione o Evento</label>
      <select class="form-control" id="contratoEvento" onchange="carregarDadosContrato()">
        <option value="">Selecione...</option>
      </select>
    </div>
    
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Data do Contrato</label>
        <input type="date" class="form-control" id="contratoData">
      </div>
      <div class="form-group">
        <label class="form-label">Cl√°usulas Adicionais</label>
        <textarea class="form-control" id="contratoClausulas" rows="2" placeholder="Cl√°usulas espec√≠ficas..."></textarea>
      </div>
    </div>
    
    <div class="form-group">
      <label class="form-label">Assinatura do Contratante (DJ)</label>
      <div class="signature-pad-container">
        <canvas id="assinaturaContratante" class="signature-pad"></canvas>
        <div style="margin-top: 10px; display: flex; gap: 10px;">
          <button type="button" class="btn btn-sm btn-secondary" onclick="limparAssinatura('contratante')">üóëÔ∏è Limpar</button>
          <button type="button" class="btn btn-sm btn-success" onclick="salvarAssinatura('contratante')">üíæ Salvar Assinatura</button>
        </div>
      </div>
    </div>
    
    <div class="form-group">
      <label class="form-label">Assinatura do Cliente</label>
      <div class="signature-pad-container">
        <canvas id="assinaturaCliente" class="signature-pad"></canvas>
        <div style="margin-top: 10px; display: flex; gap: 10px;">
          <button type="button" class="btn btn-sm btn-secondary" onclick="limparAssinatura('cliente')">üóëÔ∏è Limpar</button>
          <button type="button" class="btn btn-sm btn-success" onclick="salvarAssinatura('cliente')">üíæ Salvar Assinatura</button>
        </div>
      </div>
    </div>
    
    <div style="display: flex; gap: 10px; margin-top: 20px;">
      <button class="btn btn-success btn-lg" onclick="gerarContrato()" style="flex: 1;">üëÅÔ∏è Visualizar Contrato</button>
      <button class="btn btn-primary btn-lg" onclick="imprimirContrato()" style="flex: 1;">üñ®Ô∏è Imprimir/Salvar PDF</button>
    </div>
  </div>

  <!-- √ÅREA DE IMPRESS√ÉO DO CONTRATO -->
  <div id="contractPrintArea">
    <h2>CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS</h2>
    
    <p><strong>CONTRATANTE:</strong> <span id="printContratanteNome"></span>, <span id="printContratanteDocumento"></span>, residente √† <span id="printContratanteEndereco"></span>.</p>
    
    <p><strong>CONTRATADO:</strong> <span id="printContratadoNome">DJ PRO SERVI√áOS</span>, CNPJ: <span id="printContratadoDocumento">00.000.000/0000-00</span>, representado por <span id="printContratadoRepresentante"></span>, residente √† <span id="printContratadoEndereco">Endere√ßo do DJ</span>.</p>
    
    <p><strong>OBJETO:</strong> Presta√ß√£o de servi√ßos de discotecagem/sonoriza√ß√£o para o evento de <strong><span id="printEventoTipo"></span></strong>, a ser realizado no dia <strong><span id="printEventoData"></span></strong>, das <strong><span id="printEventoHoraInicio"></span></strong> √†s <strong><span id="printEventoHoraFim"></span></strong>, no local <strong><span id="printEventoLocal"></span></strong>.</p>
    
    <p><strong>VALOR:</strong> O valor total do contrato √© de <strong>R$ <span id="printValorTotal"></span></strong> (<span id="printValorExtenso"></span>), sendo <strong>R$ <span id="printValorEntrada"></span></strong> pago como sinal/entrada na data de assinatura deste contrato, e o saldo remanescente de <strong>R$ <span id="printValorSaldo"></span></strong> a ser pago at√© o dia do evento.</p>
    
    <p><strong>OBRIGA√á√ïES DO CONTRATADO:</strong> O CONTRATADO se obriga a fornecer equipamento de som adequado para o evento, ilumina√ß√£o b√°sica, e a presen√ßa de um DJ profissional durante todo o per√≠odo contratado.</p>
    
    <p><strong>OBRIGA√á√ïES DO CONTRATANTE:</strong> O CONTRATANTE se obriga a fornecer energia el√©trica adequada, local coberto para equipamentos (em caso de evento externo), e efetuar o pagamento conforme acordado.</p>
    
    <p><strong>CANCELAMENTO:</strong> Em caso de cancelamento por parte do CONTRATANTE, o sinal/entrada n√£o ser√° devolvido. Em caso de cancelamento por parte do CONTRATADO, o valor pago ser√° devolvido em dobro.</p>
    
    <p id="printClausulasAdicionais" style="display: none;"><strong>CL√ÅUSULAS ADICIONAIS:</strong> <span id="printClausulasTexto"></span></p>
    
    <p style="margin-top: 30px;">E, por estarem assim justos e contratados, firmam o presente instrumento em duas vias de igual teor e forma.</p>
    
    <p style="text-align: center; margin-top: 20px;"><span id="printCidadeData"></span>, <span id="printDataContrato"></span></p>
    
    <div class="signature-area">
      <div class="signature-box">
        <div class="signature-line">
          <img id="imgAssinaturaContratante" class="signature-img" style="display: none;">
        </div>
        <p><strong>CONTRATANTE</strong><br><span id="printNomeAssinaturaContratante"></span></p>
      </div>
      <div class="signature-box">
        <div class="signature-line">
          <img id="imgAssinaturaCliente" class="signature-img" style="display: none;">
        </div>
        <p><strong>CONTRATADO</strong><br><span id="printNomeAssinaturaCliente"></span></p>
      </div>
    </div>
  </div>
</section>

<!-- RECIBOS -->
<section id="recibos" class="section">
  <div class="card">
    <div class="card-title">üßæ Novo Recibo</div>
    <form id="formRecibo" onsubmit="salvarRecibo(event)">
      <div class="form-group">
        <label class="form-label">Cliente</label>
        <select class="form-control" id="reciboCliente" required onchange="carregarEventosCliente()">
          <option value="">Selecione um cliente...</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label">Evento Associado</label>
        <select class="form-control" id="reciboEvento" required>
          <option value="">Selecione um evento...</option>
        </select>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Valor (R$)</label>
          <input type="number" step="0.01" class="form-control" id="reciboValor" required placeholder="0,00">
        </div>
        <div class="form-group">
          <label class="form-label">Data do Pagamento</label>
          <input type="date" class="form-control" id="reciboData" required>
        </div>
      </div>
      
      <div class="form-group">
        <label class="form-label">Forma de Pagamento</label>
        <select class="form-control" id="reciboFormaPagamento" required>
          <option value="Dinheiro">Dinheiro</option>
          <option value="Pix">Pix</option>
          <option value="Cart√£o de Cr√©dito">Cart√£o de Cr√©dito</option>
          <option value="Cart√£o de D√©bito">Cart√£o de D√©bito</option>
          <option value="Transfer√™ncia">Transfer√™ncia Banc√°ria</option>
          <option value="Boleto">Boleto</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label">Referente a</label>
        <input type="text" class="form-control" id="reciboReferente" required placeholder="Ex: Sinal do evento, Pagamento parcial, etc">
      </div>
      
      <button type="submit" class="btn btn-lg">üíæ Salvar Recibo</button>
    </form>
  </div>

  <div class="card">
    <div class="card-title">üìã Hist√≥rico de Recibos</div>
    <div id="listaRecibos">
      <div class="empty-state">
        <div class="empty-state-icon">üßæ</div>
        <p>Nenhum recibo emitido</p>
      </div>
    </div>
  </div>
</section>

<!-- CAIXA/FINANCEIRO -->
<section id="caixa" class="section">
  <div class="financial-summary">
    <h3>üí∞ Fluxo de Caixa</h3>
    <div class="financial-grid">
      <div class="financial-item">
        <div class="financial-value" id="caixaEntradas">R$ 0</div>
        <div class="financial-label">Total Entradas</div>
      </div>
      <div class="financial-item">
        <div class="financial-value" id="caixaSaidas">R$ 0</div>
        <div class="financial-label">Total Sa√≠das</div>
      </div>
      <div class="financial-item">
        <div class="financial-value" id="caixaSaldo">R$ 0</div>
        <div class="financial-label">Saldo Atual</div>
      </div>
      <div class="financial-item">
        <div class="financial-value" id="caixaPrevisto">R$ 0</div>
        <div class="financial-label">Valor Previsto</div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">üíµ Lan√ßamento</div>
    <form id="formCaixa" onsubmit="salvarLancamento(event)">
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Tipo</label>
          <select class="form-control" id="caixaTipo" required onchange="toggleClienteLancamento()">
            <option value="entrada">Entrada (Recebimento)</option>
            <option value="saida">Sa√≠da (Despesa)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Valor (R$)</label>
          <input type="number" step="0.01" class="form-control" id="caixaValor" required placeholder="0,00">
        </div>
      </div>
      
      <div class="form-group" id="grupoClienteLancamento">
        <label class="form-label">Associar a Cliente (opcional)</label>
        <select class="form-control" id="caixaCliente" onchange="carregarEventosCaixa()">
          <option value="">Nenhum</option>
        </select>
      </div>
      
      <div class="form-group" id="grupoEventoLancamento" style="display: none;">
        <label class="form-label">Associar a Evento</label>
        <select class="form-control" id="caixaEvento">
          <option value="">Nenhum</option>
        </select>
      </div>
      
      <div class="form-group">
        <label class="form-label">Descri√ß√£o</label>
        <input type="text" class="form-control" id="caixaDescricao" required placeholder="Descri√ß√£o do lan√ßamento">
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Data</label>
          <input type="date" class="form-control" id="caixaData" required>
        </div>
        <div class="form-group">
          <label class="form-label">Categoria</label>
          <select class="form-control" id="caixaCategoria">
            <option value="Evento">Evento</option>
            <option value="Equipamento">Equipamento</option>
            <option value="Marketing">Marketing</option>
            <option value="Transporte">Transporte</option>
            <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
            <option value="Outros">Outros</option>
          </select>
        </div>
      </div>
      
      <button type="submit" class="btn btn-lg">üíæ Salvar Lan√ßamento</button>
    </form>
  </div>

  <div class="card">
    <div class="card-title">üìã Extrato</div>
    <div id="listaCaixa">
      <div class="empty-state">
        <div class="empty-state-icon">üí∞</div>
        <p>Nenhum lan√ßamento</p>
      </div>
    </div>
  </div>
</section>

<!-- PERFIL -->
<section id="perfil" class="section">
  <div class="profile-header">
    <div class="profile-avatar">üéß</div>
    <div class="profile-name" id="profileName">DJ Pro</div>
    <div class="profile-role">Administrador</div>
  </div>

  <div class="card">
    <div class="card-title">‚öôÔ∏è Configura√ß√µes</div>
    
    <div class="section-group">
      <div class="section-group-title">üé® Tema</div>
      <button class="btn btn-secondary" onclick="toggleTheme()" style="width: 100%;">
        Alternar Tema Claro/Escuro
      </button>
    </div>
    
    <div class="section-group">
      <div class="section-group-title">üé® Cor Principal</div>
      <div class="color-picker">
        <div class="color-option selected" style="background: #0b76d1;" onclick="setColor('blue')" data-color="blue">‚úì</div>
        <div class="color-option" style="background: #6f42c1;" onclick="setColor('purple')" data-color="purple"></div>
        <div class="color-option" style="background: #28a745;" onclick="setColor('green')" data-color="green"></div>
        <div class="color-option" style="background: #dc3545;" onclick="setColor('red')" data-color="red"></div>
        <div class="color-option" style="background: #fd7e14;" onclick="setColor('orange')" data-color="orange"></div>
        <div class="color-option" style="background: #e83e8c;" onclick="setColor('pink')" data-color="pink"></div>
        <div class="color-option" style="background: #343a40;" onclick="setColor('black')" data-color="black"></div>
      </div>
    </div>
    
    <div class="section-group">
      <div class="section-group-title">üîí Seguran√ßa</div>
      <button class="btn btn-secondary" onclick="alterarPin()" style="width: 100%; margin-bottom: 10px;">
        Alterar PIN de Acesso
      </button>
      <button class="btn btn-danger" onclick="logout()" style="width: 100%;">
        Sair da Conta
      </button>
    </div>
    
    <div class="section-group">
      <div class="section-group-title">üíæ Dados</div>
      <button class="btn btn-success" onclick="exportarDados()" style="width: 100%; margin-bottom: 10px;">
        üì• Exportar Dados (JSON)
      </button>
      <button class="btn btn-warning" onclick="document.getElementById('importFile').click()" style="width: 100%;">
        üì§ Importar Dados
      </button>
      <input type="file" id="importFile" style="display: none;" accept=".json" onchange="importarDados(this)">
    </div>
  </div>
</section>

</main>

<!-- NAVEGA√á√ÉO INFERIOR -->
<nav class="bottom-nav">
  <button class="nav-item active" onclick="showTab('dashboard')" data-tab="dashboard">
    <span class="icon">üìä</span>
    <span>In√≠cio</span>
  </button>
  <button class="nav-item" onclick="showTab('clientes')" data-tab="clientes">
    <span class="icon">üë•</span>
    <span>Clientes</span>
  </button>
  <button class="nav-item" onclick="showTab('eventos')" data-tab="eventos">
    <span class="icon">üéâ</span>
    <span>Eventos</span>
  </button>
  <button class="nav-item" onclick="showTab('contratos')" data-tab="contratos">
    <span class="icon">üìÑ</span>
    <span>Contratos</span>
  </button>
  <button class="nav-item" onclick="showTab('caixa')" data-tab="caixa">
    <span class="icon">üí∞</span>
    <span>Caixa</span>
  </button>
</nav>

<!-- MODAL DE CONFIGURA√á√ÉO -->
<div id="modalConfig" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-header">
      <h3>‚öôÔ∏è Configura√ß√µes R√°pidas</h3>
      <button class="modal-close" onclick="closeModal('config')">√ó</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Nome do DJ/Empresa</label>
        <input type="text" class="form-control" id="configNome" placeholder="Seu nome ou nome da empresa">
      </div>
      <div class="form-group">
        <label class="form-label">CNPJ/CPF</label>
        <input type="text" class="form-control" id="configDocumento" placeholder="Documento">
      </div>
      <div class="form-group">
        <label class="form-label">Endere√ßo Comercial</label>
        <textarea class="form-control" id="configEndereco" rows="2" placeholder="Endere√ßo completo"></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">Telefone Comercial</label>
        <input type="text" class="form-control" id="configTelefone" placeholder="(00) 00000-0000">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal('config')">Cancelar</button>
      <button class="btn" onclick="salvarConfiguracoes()">Salvar</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toast" class="toast"></div>

<script>
// ==================== VARI√ÅVEIS GLOBAIS ====================
let db = {
  clientes: [],
  eventos: [],
  recibos: [],
  caixa: [],
  configuracoes: {
    nome: 'DJ Pro',
    documento: '',
    endereco: '',
    telefone: '',
    tema: 'light',
    cor: 'blue',
    pin: '1234'
  }
};

let currentPin = '';
let assinaturas = {
  contratante: null,
  cliente: null
};

// ==================== INICIALIZA√á√ÉO ====================
document.addEventListener('DOMContentLoaded', function() {
  carregarDados();
  initSignaturePads();
  
  // Definir data atual nos campos de data
  const hoje = new Date().toISOString().split('T')[0];
  document.getElementById('contratoData').value = hoje;
  document.getElementById('reciboData').value = hoje;
  document.getElementById('caixaData').value = hoje;
  
  atualizarDashboard();
  atualizarSelects();
});

// ==================== NAVEGA√á√ÉO ====================
function showTab(tabName) {
  // Esconder todas as se√ß√µes
  document.querySelectorAll('.section').forEach(section => {
    section.classList.remove('active');
  });
  
  // Mostrar se√ß√£o selecionada
  document.getElementById(tabName).classList.add('active');
  
  // Atualizar navega√ß√£o
  document.querySelectorAll('.nav-item').forEach(item => {
    item.classList.remove('active');
    if(item.dataset.tab === tabName) {
      item.classList.add('active');
    }
  });
  
  // Atualizar selects quando entrar em certas abas
  if(tabName === 'eventos') atualizarSelectClientes();
  if(tabName === 'contratos') atualizarSelectContratos();
  if(tabName === 'recibos') {
    atualizarSelectRecibos();
    carregarEventosCliente();
  }
  if(tabName === 'caixa') atualizarSelectCaixa();
  
  // Rolar para o topo
  window.scrollTo(0, 0);
}

// ==================== ASSINATURAS DIGITAIS ====================
let signaturePads = {};

function initSignaturePads() {
  const canvasContratante = document.getElementById('assinaturaContratante');
  const canvasCliente = document.getElementById('assinaturaCliente');
  
  if(canvasContratante) {
    signaturePads.contratante = initSignaturePad(canvasContratante);
  }
  if(canvasCliente) {
    signaturePads.cliente = initSignaturePad(canvasCliente);
  }
}

function initSignaturePad(canvas) {
  const ctx = canvas.getContext('2d');
  let isDrawing = false;
  let lastX = 0;
  let lastY = 0;
  
  // Ajustar tamanho do canvas
  function resizeCanvas() {
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width;
    canvas.height = rect.height;
    ctx.strokeStyle = '#000';
    ctx.lineWidth = 2;
    ctx.lineCap = 'round';
  }
  
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);
  
  function getPos(e) {
    const rect = canvas.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    return {
      x: clientX - rect.left,
      y: clientY - rect.top
    };
  }
  
  function startDrawing(e) {
    isDrawing = true;
    const pos = getPos(e);
    lastX = pos.x;
    lastY = pos.y;
    e.preventDefault();
  }
  
  function draw(e) {
    if(!isDrawing) return;
    const pos = getPos(e);
    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
    ctx.lineTo(pos.x, pos.y);
    ctx.stroke();
    lastX = pos.x;
    lastY = pos.y;
    e.preventDefault();
  }
  
  function stopDrawing() {
    isDrawing = false;
  }
  
  // Mouse events
  canvas.addEventListener('mousedown', startDrawing);
  canvas.addEventListener('mousemove', draw);
  canvas.addEventListener('mouseup', stopDrawing);
  canvas.addEventListener('mouseout', stopDrawing);
  
  // Touch events
  canvas.addEventListener('touchstart', startDrawing);
  canvas.addEventListener('touchmove', draw);
  canvas.addEventListener('touchend', stopDrawing);
  
  return {
    clear: function() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    },
    toDataURL: function() {
      return canvas.toDataURL();
    },
    isEmpty: function() {
      const pixelBuffer = new Uint32Array(
        ctx.getImageData(0, 0, canvas.width, canvas.height).data.buffer
      );
      return !pixelBuffer.some(color => color !== 0);
    }
  };
}

function limparAssinatura(tipo) {
  if(signaturePads[tipo]) {
    signaturePads[tipo].clear();
    assinaturas[tipo] = null;
    showToast(`Assinatura do ${tipo === 'contratante' ? 'contratante' : 'cliente'} limpa`);
  }
}

function salvarAssinatura(tipo) {
  if(signaturePads[tipo] && !signaturePads[tipo].isEmpty()) {
    assinaturas[tipo] = signaturePads[tipo].toDataURL();
    showToast(`Assinatura do ${tipo === 'contratante' ? 'contratante' : 'cliente'} salva!`);
  } else {
    showToast('Fa√ßa a assinatura primeiro!', 'error');
  }
}

// ==================== CLIENTES ====================
function salvarCliente(e) {
  e.preventDefault();
  
  const cliente = {
    id: Date.now(),
    nome: document.getElementById('clienteNome').value,
    documento: document.getElementById('clienteDocumento').value,
    cep: document.getElementById('clienteCep').value,
    rua: document.getElementById('clienteRua').value,
    numero: document.getElementById('clienteNumero').value,
    complemento: document.getElementById('clienteComplemento').value,
    bairro: document.getElementById('clienteBairro').value,
    cidade: document.getElementById('clienteCidade').value,
    estado: document.getElementById('clienteEstado').value,
    telefone: document.getElementById('clienteTelefone').value,
    email: document.getElementById('clienteEmail').value,
    dataCadastro: new Date().toISOString()
  };
  
  db.clientes.push(cliente);
  salvarDados();
  
  showToast('Cliente salvo com sucesso!');
  document.getElementById('formCliente').reset();
  atualizarListaClientes();
  atualizarSelects();
}

function buscarCep() {
  const cep = document.getElementById('clienteCep').value.replace(/\D/g, '');
  if(cep.length === 8) {
    fetch(`https://viacep.com.br/ws/${cep}/json/`)
      .then(res => res.json())
      .then(data => {
        if(!data.erro) {
          document.getElementById('clienteRua').value = data.logradouro;
          document.getElementById('clienteBairro').value = data.bairro;
          document.getElementById('clienteCidade').value = data.localidade;
          document.getElementById('clienteEstado').value = data.uf;
          document.getElementById('clienteNumero').focus();
        }
      })
      .catch(() => showToast('Erro ao buscar CEP', 'error'));
  }
}

function atualizarListaClientes() {
  const container = document.getElementById('listaClientes');
  
  if(db.clientes.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">üë§</div>
        <p>Nenhum cliente cadastrado</p>
      </div>
    `;
    return;
  }
  
  container.innerHTML = db.clientes.map(cliente => {
    const endereco = `${cliente.rua}, ${cliente.numero}${cliente.complemento ? ' - ' + cliente.complemento : ''}, ${cliente.bairro}, ${cliente.cidade}-${cliente.estado}, CEP: ${cliente.cep}`;
    
    // Calcular total recebido deste cliente
    const totalRecebido = db.caixa
      .filter(l => l.clienteId === cliente.id && l.tipo === 'entrada')
      .reduce((sum, l) => sum + l.valor, 0);
    
    const eventosCount = db.eventos.filter(e => e.clienteId === cliente.id).length;
    
    return `
      <div class="list-item">
        <div class="list-item-header">
          <div>
            <div class="list-item-title">${cliente.nome}</div>
            <div class="list-item-meta">üìç ${endereco}</div>
            <div class="list-item-meta">üì± ${cliente.telefone || 'Sem telefone'} | ‚úâÔ∏è ${cliente.email || 'Sem e-mail'}</div>
            <div class="list-item-meta" style="margin-top: 8px;">
              <span class="badge badge-info">${eventosCount} eventos</span>
              <span class="badge badge-success">Recebido: R$ ${totalRecebido.toFixed(2)}</span>
            </div>
          </div>
        </div>
        <div class="list-item-actions">
          <button class="btn btn-sm btn-secondary" onclick="editarCliente(${cliente.id})">‚úèÔ∏è Editar</button>
          <button class="btn btn-sm btn-danger" onclick="excluirCliente(${cliente.id})">üóëÔ∏è Excluir</button>
        </div>
      </div>
    `;
  }).join('');
}

// ==================== EVENTOS ====================
function salvarEvento(e) {
  e.preventDefault();
  
  const clienteId = parseInt(document.getElementById('eventoCliente').value);
  const cliente = db.clientes.find(c => c.id === clienteId);
  
  const evento = {
    id: Date.now(),
    clienteId: clienteId,
    clienteNome: cliente ? cliente.nome : '',
    tipo: document.getElementById('eventoTipo').value,
    data: document.getElementById('eventoData').value,
    horaInicio: document.getElementById('eventoHoraInicio').value,
    horaFim: document.getElementById('eventoHoraFim').value,
    local: document.getElementById('eventoLocal').value,
    valorTotal: parseFloat(document.getElementById('eventoValorTotal').value) || 0,
    valorEntrada: parseFloat(document.getElementById('eventoValorEntrada').value) || 0,
    observacoes: document.getElementById('eventoObservacoes').value,
    status: 'agendado',
    dataCadastro: new Date().toISOString()
  };
  
  db.eventos.push(evento);
  
  // Se houver entrada, criar lan√ßamento no caixa automaticamente
  if(evento.valorEntrada > 0) {
    const lancamento = {
      id: Date.now(),
      tipo: 'entrada',
      valor: evento.valorEntrada,
      descricao: `Sinal - ${evento.tipo} de ${cliente.nome}`,
      clienteId: clienteId,
      eventoId: evento.id,
      data: new Date().toISOString().split('T')[0],
      categoria: 'Evento'
    };
    db.caixa.push(lancamento);
    
    // Criar recibo automaticamente
    const recibo = {
      id: Date.now(),
      clienteId: clienteId,
      eventoId: evento.id,
      clienteNome: cliente.nome,
      valor: evento.valorEntrada,
      data: new Date().toISOString().split('T')[0],
      formaPagamento: 'N√£o especificado',
      referente: `Sinal/Entrada - ${evento.tipo}`
    };
    db.recibos.push(recibo);
  }
  
  salvarDados();
  showToast('Evento salvo com sucesso!');
  document.getElementById('formEvento').reset();
  atualizarListaEventos();
  atualizarDashboard();
}

function calcularSaldo() {
  const total = parseFloat(document.getElementById('eventoValorTotal').value) || 0;
  const entrada = parseFloat(document.getElementById('eventoValorEntrada').value) || 0;
  const saldo = total - entrada;
  
  document.getElementById('eventoSaldo').value = `R$ ${saldo.toFixed(2)}`;
}

function atualizarListaEventos() {
  const container = document.getElementById('listaEventos');
  
  if(db.eventos.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">üìÖ</div>
        <p>Nenhum evento cadastrado</p>
      </div>
    `;
    return;
  }
  
  // Ordenar por data (mais recente primeiro)
  const eventosOrdenados = [...db.eventos].sort((a, b) => new Date(b.data) - new Date(a.data));
  
  container.innerHTML = eventosOrdenados.map(evento => {
    const dataEvento = new Date(evento.data);
    const hoje = new Date();
    const diasRestantes = Math.ceil((dataEvento - hoje) / (1000 * 60 * 60 * 24));
    
    let statusBadge = '';
    if(diasRestantes < 0) statusBadge = '<span class="badge badge-secondary">Realizado</span>';
    else if(diasRestantes === 0) statusBadge = '<span class="badge badge-danger">Hoje</span>';
    else if(diasRestantes <= 7) statusBadge = '<span class="badge badge-warning">Em ' + diasRestantes + ' dias</span>';
    else statusBadge = '<span class="badge badge-info">Agendado</span>';
    
    // Calcular total recebido deste evento
    const totalRecebido = db.caixa
      .filter(l => l.eventoId === evento.id && l.tipo === 'entrada')
      .reduce((sum, l) => sum + l.valor, 0);
    
    const percentualPago = evento.valorTotal > 0 ? (totalRecebido / evento.valorTotal * 100) : 0;
    
    return `
      <div class="list-item">
        <div class="list-item-header">
          <div>
            <div class="list-item-title">${evento.tipo} - ${evento.clienteNome}</div>
            <div class="list-item-meta">üìÖ ${formatarData(evento.data)} | ‚è∞ ${evento.horaInicio} √†s ${evento.horaFim}</div>
            <div class="list-item-meta">üìç ${evento.local}</div>
            <div class="list-item-meta" style="margin-top: 8px;">
              ${statusBadge}
              <span class="badge badge-success">R$ ${totalRecebido.toFixed(2)} / R$ ${evento.valorTotal.toFixed(2)}</span>
            </div>
            <div class="progress-bar" style="margin-top: 10px;">
              <div class="progress-fill" style="width: ${Math.min(percentualPago, 100)}%">
                ${percentualPago.toFixed(0)}%
              </div>
            </div>
          </div>
        </div>
        <div class="payment-history">
          <strong>üí∞ Pagamentos:</strong>
          ${renderizarPagamentosEvento(evento.id)}
        </div>
        <div class="list-item-actions">
          <button class="btn btn-sm btn-secondary" onclick="adicionarPagamento(${evento.id})">üíµ Add Pagamento</button>
          <button class="btn btn-sm" onclick="gerarContratoEvento(${evento.id})">üìÑ Contrato</button>
          <button class="btn btn-sm btn-danger" onclick="excluirEvento(${evento.id})">üóëÔ∏è Excluir</button>
        </div>
      </div>
    `;
  }).join('');
}

function renderizarPagamentosEvento(eventoId) {
  const pagamentos = db.caixa.filter(l => l.eventoId === eventoId && l.tipo === 'entrada');
  
  if(pagamentos.length === 0) return '<div class="payment-item"><span>Sem pagamentos registrados</span></div>';
  
  return pagamentos.map(p => `
    <div class="payment-item">
      <span>${formatarData(p.data)} - ${p.descricao}</span>
      <strong>R$ ${p.valor.toFixed(2)}</strong>
    </div>
  `).join('');
}

function adicionarPagamento(eventoId) {
  const evento = db.eventos.find(e => e.id === eventoId);
  if(!evento) return;
  
  const valor = prompt('Digite o valor do pagamento (R$):');
  if(!valor || isNaN(valor)) return;
  
  const formaPagamento = prompt('Forma de pagamento (Dinheiro, Pix, Cart√£o, etc):') || 'N√£o especificado';
  
  const lancamento = {
    id: Date.now(),
    tipo: 'entrada',
    valor: parseFloat(valor),
    descricao: `Pagamento - ${evento.tipo} de ${evento.clienteNome}`,
    clienteId: evento.clienteId,
    eventoId: eventoId,
    data: new Date().toISOString().split('T')[0],
    categoria: 'Evento'
  };
  
  db.caixa.push(lancamento);
  
  // Criar recibo
  const recibo = {
    id: Date.now(),
    clienteId: evento.clienteId,
    eventoId: eventoId,
    clienteNome: evento.clienteNome,
    valor: parseFloat(valor),
    data: new Date().toISOString().split('T')[0],
    formaPagamento: formaPagamento,
    referente: `Pagamento parcial - ${evento.tipo}`
  };
  db.recibos.push(recibo);
  
  salvarDados();
  showToast('Pagamento registrado com sucesso!');
  atualizarListaEventos();
  atualizarDashboard();
}

// ==================== CONTRATOS ====================
function carregarDadosContrato() {
  const eventoId = document.getElementById('contratoEvento').value;
  if(!eventoId) return;
  
  const evento = db.eventos.find(e => e.id === parseInt(eventoId));
  if(!evento) return;
  
  const cliente = db.clientes.find(c => c.id === evento.clienteId);
  
  // Preencher dados no contrato
  document.getElementById('printContratanteNome').textContent = cliente ? cliente.nome : '';
  document.getElementById('printContratanteDocumento').textContent = cliente ? cliente.documento : '';
  document.getElementById('printContratanteEndereco').textContent = cliente ? 
    `${cliente.rua}, ${cliente.numero}, ${cliente.bairro}, ${cliente.cidade}-${cliente.estado}` : '';
  
  document.getElementById('printContratadoRepresentante').textContent = db.configuracoes.nome;
  document.getElementById('printEventoTipo').textContent = evento.tipo;
  document.getElementById('printEventoData').textContent = formatarData(evento.data);
  document.getElementById('printEventoHoraInicio').textContent = evento.horaInicio;
  document.getElementById('printEventoHoraFim').textContent = evento.horaFim;
  document.getElementById('printEventoLocal').textContent = evento.local;
  document.getElementById('printValorTotal').textContent = evento.valorTotal.toFixed(2);
  document.getElementById('printValorEntrada').textContent = evento.valorEntrada.toFixed(2);
  document.getElementById('printValorSaldo').textContent = (evento.valorTotal - evento.valorEntrada).toFixed(2);
  document.getElementById('printValorExtenso').textContent = valorPorExtenso(evento.valorTotal);
  
  const clausulas = document.getElementById('contratoClausulas').value;
  if(clausulas) {
    document.getElementById('printClausulasAdicionais').style.display = 'block';
    document.getElementById('printClausulasTexto').textContent = clausulas;
  } else {
    document.getElementById('printClausulasAdicionais').style.display = 'none';
  }
  
  // Data do contrato
  const dataContrato = document.getElementById('contratoData').value;
  document.getElementById('printDataContrato').textContent = formatarData(dataContrato);
  document.getElementById('printCidadeData').textContent = cliente ? cliente.cidade : '';
  
  // Nomes nas assinaturas
  document.getElementById('printNomeAssinaturaContratante').textContent = cliente ? cliente.nome : '';
  document.getElementById('printNomeAssinaturaCliente').textContent = db.configuracoes.nome;
}

function gerarContrato() {
  const eventoId = document.getElementById('contratoEvento').value;
  if(!eventoId) {
    showToast('Selecione um evento primeiro!', 'error');
    return;
  }
  
  carregarDadosContrato();
  
  // Mostrar assinaturas se existirem
  if(assinaturas.contratante) {
    document.getElementById('imgAssinaturaContratante').src = assinaturas.contratante;
    document.getElementById('imgAssinaturaContratante').style.display = 'block';
  } else {
    document.getElementById('imgAssinaturaContratante').style.display = 'none';
  }
  
  if(assinaturas.cliente) {
    document.getElementById('imgAssinaturaCliente').src = assinaturas.cliente;
    document.getElementById('imgAssinaturaCliente').style.display = 'block';
  } else {
    document.getElementById('imgAssinaturaCliente').style.display = 'none';
  }
  
  // Mostrar √°rea do contrato
  const printArea = document.getElementById('contractPrintArea');
  printArea.style.display = 'block';
  printArea.scrollIntoView({ behavior: 'smooth' });
  
  showToast('Contrato gerado! Use o bot√£o Imprimir para salvar PDF.');
}

function imprimirContrato() {
  if(!document.getElementById('contratoEvento').value) {
    showToast('Gere o contrato primeiro!', 'error');
    return;
  }
  
  window.print();
}

function gerarContratoEvento(eventoId) {
  showTab('contratos');
  document.getElementById('contratoEvento').value = eventoId;
  carregarDadosContrato();
  gerarContrato();
}

// ==================== RECIBOS ====================
function salvarRecibo(e) {
  e.preventDefault();
  
  const clienteId = parseInt(document.getElementById('reciboCliente').value);
  const cliente = db.clientes.find(c => c.id === clienteId);
  const eventoId = parseInt(document.getElementById('reciboEvento').value);
  const evento = db.eventos.find(e => e.id === eventoId);
  
  const recibo = {
    id: Date.now(),
    clienteId: clienteId,
    eventoId: eventoId,
    clienteNome: cliente ? cliente.nome : '',
    valor: parseFloat(document.getElementById('reciboValor').value) || 0,
    data: document.getElementById('reciboData').value,
    formaPagamento: document.getElementById('reciboFormaPagamento').value,
    referente: document.getElementById('reciboReferente').value
  };
  
  db.recibos.push(recibo);
  
  // Adicionar ao caixa tamb√©m
  const lancamento = {
    id: Date.now(),
    tipo: 'entrada',
    valor: recibo.valor,
    descricao: `Recibo: ${recibo.referente} - ${cliente.nome}`,
    clienteId: clienteId,
    eventoId: eventoId,
    data: recibo.data,
    categoria: 'Evento'
  };
  db.caixa.push(lancamento);
  
  salvarDados();
  showToast('Recibo salvo com sucesso!');
  document.getElementById('formRecibo').reset();
  atualizarListaRecibos();
  atualizarDashboard();
}

function atualizarListaRecibos() {
  const container = document.getElementById('listaRecibos');
  
  if(db.recibos.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">üßæ</div>
        <p>Nenhum recibo emitido</p>
      </div>
    `;
    return;
  }
  
  // Ordenar por data (mais recente primeiro)
  const recibosOrdenados = [...db.recibos].sort((a, b) => new Date(b.data) - new Date(a.data));
  
  container.innerHTML = recibosOrdenados.map(recibo => `
    <div class="list-item">
      <div class="list-item-header">
        <div>
          <div class="list-item-title">R$ ${recibo.valor.toFixed(2)} - ${recibo.clienteNome}</div>
          <div class="list-item-meta">üìÖ ${formatarData(recibo.data)} | üí≥ ${recibo.formaPagamento}</div>
          <div class="list-item-meta">üìù ${recibo.referente}</div>
        </div>
      </div>
      <div class="list-item-actions">
        <button class="btn btn-sm" onclick="imprimirRecibo(${recibo.id})">üñ®Ô∏è Imprimir</button>
        <button class="btn btn-sm btn-danger" onclick="excluirRecibo(${recibo.id})">üóëÔ∏è Excluir</button>
      </div>
    </div>
  `).join('');
}

// ==================== CAIXA ====================
function salvarLancamento(e) {
  e.preventDefault();
  
  const tipo = document.getElementById('caixaTipo').value;
  const clienteId = document.getElementById('caixaCliente').value;
  const eventoId = document.getElementById('caixaEvento').value;
  
  const lancamento = {
    id: Date.now(),
    tipo: tipo,
    valor: parseFloat(document.getElementById('caixaValor').value) || 0,
    descricao: document.getElementById('caixaDescricao').value,
    clienteId: clienteId ? parseInt(clienteId) : null,
    eventoId: eventoId ? parseInt(eventoId) : null,
    data: document.getElementById('caixaData').value,
    categoria: document.getElementById('caixaCategoria').value
  };
  
  db.caixa.push(lancamento);
  salvarDados();
  
  showToast('Lan√ßamento salvo com sucesso!');
  document.getElementById('formCaixa').reset();
  atualizarListaCaixa();
  atualizarDashboard();
}

function toggleClienteLancamento() {
  const tipo = document.getElementById('caixaTipo').value;
  const grupoCliente = document.getElementById('grupoClienteLancamento');
  const grupoEvento = document.getElementById('grupoEventoLancamento');
  
  if(tipo === 'entrada') {
    grupoCliente.style.display = 'block';
  } else {
    grupoCliente.style.display = 'none';
    grupoEvento.style.display = 'none';
    document.getElementById('caixaCliente').value = '';
    document.getElementById('caixaEvento').value = '';
  }
}

function carregarEventosCaixa() {
  const clienteId = document.getElementById('caixaCliente').value;
  const selectEvento = document.getElementById('caixaEvento');
  const grupoEvento = document.getElementById('grupoEventoLancamento');
  
  if(!clienteId) {
    grupoEvento.style.display = 'none';
    return;
  }
  
  const eventos = db.eventos.filter(e => e.clienteId === parseInt(clienteId));
  
  if(eventos.length === 0) {
    grupoEvento.style.display = 'none';
    return;
  }
  
  selectEvento.innerHTML = '<option value="">Selecione um evento...</option>' +
    eventos.map(e => `<option value="${e.id}">${e.tipo} - ${formatarData(e.data)}</option>`).join('');
  
  grupoEvento.style.display = 'block';
}

function atualizarListaCaixa() {
  const container = document.getElementById('listaCaixa');
  
  if(db.caixa.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">üí∞</div>
        <p>Nenhum lan√ßamento</p>
      </div>
    `;
    return;
  }
  
  // Ordenar por data (mais recente primeiro)
  const lancamentosOrdenados = [...db.caixa].sort((a, b) => new Date(b.data) - new Date(a.data));
  
  container.innerHTML = lancamentosOrdenados.map(lanc => {
    const isEntrada = lanc.tipo === 'entrada';
    const cliente = lanc.clienteId ? db.clientes.find(c => c.id === lanc.clienteId) : null;
    
    return `
      <div class="list-item" style="border-left-color: ${isEntrada ? 'var(--success)' : 'var(--danger)'}">
        <div class="list-item-header">
          <div>
            <div class="list-item-title" style="color: ${isEntrada ? 'var(--success)' : 'var(--danger)'}">
              ${isEntrada ? '+' : '-'} R$ ${lanc.valor.toFixed(2)}
            </div>
            <div class="list-item-meta">üìÖ ${formatarData(lanc.data)} | üìÇ ${lanc.categoria}</div>
            <div class="list-item-meta">üìù ${lanc.descricao}</div>
            ${cliente ? `<div class="list-item-meta">üë§ ${cliente.nome}</div>` : ''}
          </div>
        </div>
        <div class="list-item-actions">
          <button class="btn btn-sm btn-danger" onclick="excluirLancamento(${lanc.id})">üóëÔ∏è Excluir</button>
        </div>
      </div>
    `;
  }).join('');
}

// ==================== DASHBOARD ====================
function atualizarDashboard() {
  // Totais
  const totalEntradas = db.caixa.filter(l => l.tipo === 'entrada').reduce((sum, l) => sum + l.valor, 0);
  const totalSaidas = db.caixa.filter(l => l.tipo === 'saida').reduce((sum, l) => sum + l.valor, 0);
  const saldo = totalEntradas - totalSaidas;
  
  // Total contratado (todos os eventos)
  const totalContratado = db.eventos.reduce((sum, e) => sum + e.valorTotal, 0);
  
  // Total pendente
  const totalPendente = totalContratado - totalEntradas;
  
  // M√©dia por evento
  const mediaPorEvento = db.eventos.length > 0 ? totalContratado / db.eventos.length : 0;
  
  // Atualizar cards
  document.getElementById('dashTotal').textContent = `R$ ${saldo.toFixed(2)}`;
  document.getElementById('dashEventos').textContent = db.eventos.length;
  document.getElementById('dashRecibos').textContent = db.recibos.length;
  document.getElementById('dashClientes').textContent = db.clientes.length;
  
  // Atualizar resumo financeiro
  document.getElementById('totalContratado').textContent = `R$ ${totalContratado.toFixed(2)}`;
  document.getElementById('totalRecebido').textContent = `R$ ${totalEntradas.toFixed(2)}`;
  document.getElementById('totalPendente').textContent = `R$ ${totalPendente.toFixed(2)}`;
  document.getElementById('mediaPorEvento').textContent = `R$ ${mediaPorEvento.toFixed(2)}`;
  
  // Atualizar caixa
  document.getElementById('caixaEntradas').textContent = `R$ ${totalEntradas.toFixed(2)}`;
  document.getElementById('caixaSaidas').textContent = `R$ ${totalSaidas.toFixed(2)}`;
  document.getElementById('caixaSaldo').textContent = `R$ ${saldo.toFixed(2)}`;
  document.getElementById('caixaPrevisto').textContent = `R$ ${totalPendente.toFixed(2)}`;
  
  // √öltimos eventos
  const ultimosEventos = [...db.eventos]
    .sort((a, b) => new Date(b.data) - new Date(a.data))
    .slice(0, 3);
  
  const containerUltimos = document.getElementById('ultimosEventos');
  if(ultimosEventos.length === 0) {
    containerUltimos.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">üìÖ</div>
        <p>Nenhum evento cadastrado</p>
      </div>
    `;
  } else {
    containerUltimos.innerHTML = ultimosEventos.map(evento => `
      <div class="list-item" onclick="showTab('eventos')" style="cursor: pointer;">
        <div class="list-item-title">${evento.tipo} - ${evento.clienteNome}</div>
        <div class="list-item-meta">üìÖ ${formatarData(evento.data)} | üí∞ R$ ${evento.valorTotal.toFixed(2)}</div>
      </div>
    `).join('');
  }
}

// ==================== SELECTS DIN√ÇMICOS ====================
function atualizarSelects() {
  atualizarSelectClientes();
  atualizarSelectContratos();
  atualizarSelectRecibos();
  atualizarSelectCaixa();
}

function atualizarSelectClientes() {
  const selects = ['eventoCliente'];
  selects.forEach(id => {
    const select = document.getElementById(id);
    if(select) {
      select.innerHTML = '<option value="">Selecione um cliente...</option>' +
        db.clientes.map(c => `<option value="${c.id}">${c.nome}</option>`).join('');
    }
  });
}

function atualizarSelectContratos() {
  const select = document.getElementById('contratoEvento');
  if(select) {
    select.innerHTML = '<option value="">Selecione...</option>' +
      db.eventos.map(e => `<option value="${e.id}">${e.tipo} - ${e.clienteNome} (${formatarData(e.data)})</option>`).join('');
  }
}

function atualizarSelectRecibos() {
  const select = document.getElementById('reciboCliente');
  if(select) {
    select.innerHTML = '<option value="">Selecione um cliente...</option>' +
      db.clientes.map(c => `<option value="${c.id}">${c.nome}</option>`).join('');
  }
}

function carregarEventosCliente() {
  const clienteId = document.getElementById('reciboCliente').value;
  const selectEvento = document.getElementById('reciboEvento');
  
  if(!clienteId) {
    selectEvento.innerHTML = '<option value="">Selecione um evento...</option>';
    return;
  }
  
  const eventos = db.eventos.filter(e => e.clienteId === parseInt(clienteId));
  selectEvento.innerHTML = '<option value="">Selecione um evento...</option>' +
    eventos.map(e => `<option value="${e.id}">${e.tipo} - ${formatarData(e.data)}</option>`).join('');
}

function atualizarSelectCaixa() {
  const select = document.getElementById('caixaCliente');
  if(select) {
    select.innerHTML = '<option value="">Nenhum</option>' +
      db.clientes.map(c => `<option value="${c.id}">${c.nome}</option>`).join('');
  }
}

// ==================== UTILIT√ÅRIOS ====================
function formatarData(dataString) {
  if(!dataString) return '';
  const data = new Date(dataString);
  return data.toLocaleDateString('pt-BR');
}

function valorPorExtenso(valor) {
  // Simplificado - em produ√ß√£o usar biblioteca como `extenso`
  return `${valor.toFixed(2).replace('.', ',')} reais`;
}

function showToast(mensagem, tipo = 'success') {
  const toast = document.getElementById('toast');
  toast.textContent = mensagem;
  toast.className = `toast ${tipo} show`;
  
  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000);
}

// ==================== PERSIST√äNCIA ====================
function salvarDados() {
  localStorage.setItem('djpro_data', JSON.stringify(db));
}

function carregarDados() {
  const dados = localStorage.getItem('djpro_data');
  if(dados) {
    db = JSON.parse(dados);
    // Aplicar configura√ß√µes
    if(db.configuracoes.tema === 'dark') {
      document.documentElement.setAttribute('data-theme', 'dark');
    }
    if(db.configuracoes.cor) {
      document.documentElement.setAttribute('data-color', db.configuracoes.cor);
    }
  }
}

// ==================== CONFIGURA√á√ïES ====================
function toggleTheme() {
  const html = document.documentElement;
  const current = html.getAttribute('data-theme');
  const novo = current === 'dark' ? 'light' : 'dark';
  html.setAttribute('data-theme', novo);
  db.configuracoes.tema = novo;
  salvarDados();
}

function setColor(cor) {
  document.documentElement.setAttribute('data-color', cor);
  db.configuracoes.cor = cor;
  salvarDados();
  
  document.querySelectorAll('.color-option').forEach(el => {
    el.classList.remove('selected');
    el.textContent = '';
  });
  document.querySelector(`.color-option[data-color="${cor}"]`).classList.add('selected');
  document.querySelector(`.color-option[data-color="${cor}"]`).textContent = '‚úì';
}

function showModal(modal) {
  document.getElementById(`modal${modal.charAt(0).toUpperCase() + modal.slice(1)}`).classList.add('active');
  if(modal === 'config') {
    document.getElementById('configNome').value = db.configuracoes.nome;
    document.getElementById('configDocumento').value = db.configuracoes.documento;
    document.getElementById('configEndereco').value = db.configuracoes.endereco;
    document.getElementById('configTelefone').value = db.configuracoes.telefone;
  }
}

function closeModal(modal) {
  document.getElementById(`modal${modal.charAt(0).toUpperCase() + modal.slice(1)}`).classList.remove('active');
}

function salvarConfiguracoes() {
  db.configuracoes.nome = document.getElementById('configNome').value;
  db.configuracoes.documento = document.getElementById('configDocumento').value;
  db.configuracoes.endereco = document.getElementById('configEndereco').value;
  db.configuracoes.telefone = document.getElementById('configTelefone').value;
  salvarDados();
  closeModal('config');
  showToast('Configura√ß√µes salvas!');
  atualizarDashboard();
}

// ==================== EXPORTAR/IMPORTAR ====================
function exportarDados() {
  const dataStr = JSON.stringify(db, null, 2);
  const blob = new Blob([dataStr], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `djpro_backup_${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
  showToast('Dados exportados!');
}

function importarDados(input) {
  const file = input.files[0];
  if(!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const dados = JSON.parse(e.target.result);
      if(confirm('Isso substituir√° todos os dados atuais. Deseja continuar?')) {
        db = dados;
        salvarDados();
        location.reload();
      }
    } catch(err) {
      showToast('Erro ao importar arquivo!', 'error');
    }
  };
  reader.readAsText(file);
}

// ==================== LOGIN/PIN ====================
function enterPin(num) {
  if(currentPin.length < 4) {
    currentPin += num;
    atualizarPinDisplay();
    if(currentPin.length === 4) {
      verificarPin();
    }
  }
}

function clearPin() {
  currentPin = currentPin.slice(0, -1);
  atualizarPinDisplay();
}

function atualizarPinDisplay() {
  const dots = document.querySelectorAll('.pin-dot');
  dots.forEach((dot, index) => {
    dot.classList.toggle('filled', index < currentPin.length);
  });
}

function verificarPin() {
  if(currentPin === db.configuracoes.pin) {
    document.getElementById('loginScreen').style.display = 'none';
    currentPin = '';
    atualizarPinDisplay();
  } else {
    showToast('PIN incorreto!', 'error');
    currentPin = '';
    setTimeout(atualizarPinDisplay, 200);
  }
}

function skipLogin() {
  document.getElementById('loginScreen').style.display = 'none';
}

function alterarPin() {
  const novoPin = prompt('Digite o novo PIN (4 d√≠gitos):');
  if(novoPin && novoPin.length === 4 && !isNaN(novoPin)) {
    db.configuracoes.pin = novoPin;
    salvarDados();
    showToast('PIN alterado com sucesso!');
  } else {
    showToast('PIN inv√°lido!', 'error');
  }
}

function logout() {
  document.getElementById('loginScreen').style.display = 'flex';
  currentPin = '';
  atualizarPinDisplay();
}

// ==================== EXCLUS√ïES ====================
function excluirCliente(id) {
  if(!confirm('Deseja realmente excluir este cliente?')) return;
  db.clientes = db.clientes.filter(c => c.id !== id);
  salvarDados();
  atualizarListaClientes();
  atualizarSelects();
  showToast('Cliente exclu√≠do!');
}

function excluirEvento(id) {
  if(!confirm('Deseja realmente excluir este evento?')) return;
  db.eventos = db.eventos.filter(e => e.id !== id);
  db.caixa = db.caixa.filter(l => l.eventoId !== id);
  db.recibos = db.recibos.filter(r => r.eventoId !== id);
  salvarDados();
  atualizarListaEventos();
  atualizarDashboard();
  showToast('Evento exclu√≠do!');
}

function excluirRecibo(id) {
  if(!confirm('Deseja realmente excluir este recibo?')) return;
  db.recibos = db.recibos.filter(r => r.id !== id);
  salvarDados();
  atualizarListaRecibos();
  atualizarDashboard();
  showToast('Recibo exclu√≠do!');
}

function excluirLancamento(id) {
  if(!confirm('Deseja realmente excluir este lan√ßamento?')) return;
  db.caixa = db.caixa.filter(l => l.id !== id);
  salvarDados();
  atualizarListaCaixa();
  atualizarDashboard();
  showToast('Lan√ßamento exclu√≠do!');
}

function editarCliente(id) {
  const cliente = db.clientes.find(c => c.id === id);
  if(!cliente) return;
  
  document.getElementById('clienteNome').value = cliente.nome;
  document.getElementById('clienteDocumento').value = cliente.documento;
  document.getElementById('clienteCep').value = cliente.cep || '';
  document.getElementById('clienteRua').value = cliente.rua || '';
  document.getElementById('clienteNumero').value = cliente.numero || '';
  document.getElementById('clienteComplemento').value = cliente.complemento || '';
  document.getElementById('clienteBairro').value = cliente.bairro || '';
  document.getElementById('clienteCidade').value = cliente.cidade || '';
  document.getElementById('clienteEstado').value = cliente.estado || '';
  document.getElementById('clienteTelefone').value = cliente.telefone || '';
  document.getElementById('clienteEmail').value = cliente.email || '';
  
  // Remover cliente antigo e salvar como novo
  db.clientes = db.clientes.filter(c => c.id !== id);
  showToast('Editando cliente... Salve para confirmar.');
  showTab('clientes');
}

function imprimirRecibo(id) {
  const recibo = db.recibos.find(r => r.id === id);
  if(!recibo) return;
  
  const printWindow = window.open('', '_blank');
  printWindow.document.write(`
    <html>
    <head>
      <title>Recibo ${recibo.id}</title>
      <style>
        body { font-family: Arial, sans-serif; padding: 40px; max-width: 600px; margin: 0 auto; }
        .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 30px; }
        .valor { font-size: 24px; font-weight: bold; text-align: center; margin: 30px 0; }
        .assinatura { margin-top: 60px; border-top: 1px solid #333; padding-top: 10px; text-align: center; }
        @media print { body { padding: 20px; } }
      </style>
    </head>
    <body>
      <div class="header">
        <h1>RECIBO</h1>
        <p>N¬∫ ${recibo.id}</p>
      </div>
      <p>Recebi de <strong>${recibo.clienteNome}</strong></p>
      <p>a import√¢ncia de:</p>
      <div class="valor">R$ ${recibo.valor.toFixed(2)}</div>
      <p>Referente a: <strong>${recibo.referente}</strong></p>
      <p>Forma de pagamento: <strong>${recibo.formaPagamento}</strong></p>
      <p>Data: <strong>${formatarData(recibo.data)}</strong></p>
      <div class="assinatura">
        <p>Assinatura do Recebedor</p>
        <p style="margin-top: 40px;">_______________________</p>
        <p>${db.configuracoes.nome}</p>
      </div>
    </body>
    </html>
  `);
  printWindow.document.close();
  printWindow.print();
}
</script>

</body>
</html>
